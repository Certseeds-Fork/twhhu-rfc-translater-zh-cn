{
  "title": {
    "text": "RFC 8584: Framework for Ethernet VPN Designated Forwarder Election Extensibility",
    "zh-CHS": "RFC 8584"
  },
  "number": 8584,
  "created_at": "2021-10-27 20:50:17.078836+08:00",
  "updated_by": "",
  "contents": [
    {
      "indent": 0,
      "text": "Internet Engineering Task Force (IETF)                   J. Rabadan, Ed.\nRequest for Comments: 8584                                         Nokia\nUpdates: 7432                                            S. Mohanty, Ed.\nCategory: Standards Track                                     A. Sajassi\nISSN: 2070-1721                                                    Cisco\n                                                                J. Drake\n                                                                 Juniper\n                                                              K. Nagaraj\n                                                            S. Sathappan\n                                                                   Nokia\n                                                              April 2019",
      "raw": true,
      "zh-CHS": " "
    },
    {
      "indent": 1,
      "text": "Framework for Ethernet VPN Designated Forwarder Election Extensibility",
      "zh-CHS": "以太网VPN指定转发器选择扩展框架"
    },
    {
      "indent": 0,
      "text": "Abstract",
      "zh-CHS": "摘要"
    },
    {
      "indent": 3,
      "text": "An alternative to the default Designated Forwarder (DF) selection algorithm in Ethernet VPNs (EVPNs) is defined. The DF is the Provider Edge (PE) router responsible for sending Broadcast, Unknown Unicast, and Multicast (BUM) traffic to a multihomed Customer Edge (CE) device on a given VLAN on a particular Ethernet Segment (ES). In addition, the ability to influence the DF election result for a VLAN based on the state of the associated Attachment Circuit (AC) is specified. This document clarifies the DF election Finite State Machine in EVPN services. Therefore, it updates the EVPN specification (RFC 7432).",
      "zh-CHS": "定义了以太网VPN（EVPN）中默认指定转发器（DF）选择算法的替代算法。DF是提供商边缘（PE）路由器，负责将广播、未知单播和多播（BUM）流量发送到特定以太网段（ES）上给定VLAN上的多宿客户边缘（CE）设备。此外，还规定了基于相关连接电路（AC）的状态影响VLAN的DF选择结果的能力。本文档阐明了EVPN服务中的DF选择有限状态机。因此，它更新了EVPN规范（RFC 7432）。"
    },
    {
      "indent": 0,
      "text": "Status of This Memo",
      "zh-CHS": "关于下段备忘"
    },
    {
      "indent": 3,
      "text": "This is an Internet Standards Track document.",
      "zh-CHS": "这是一份互联网标准跟踪文件。"
    },
    {
      "indent": 3,
      "text": "This document is a product of the Internet Engineering Task Force (IETF). It represents the consensus of the IETF community. It has received public review and has been approved for publication by the Internet Engineering Steering Group (IESG). Further information on Internet Standards is available in Section 2 of RFC 7841.",
      "zh-CHS": "本文件是互联网工程任务组（IETF）的产品。它代表了IETF社区的共识。它已经接受了公众审查，并已被互联网工程指导小组（IESG）批准出版。有关互联网标准的更多信息，请参见RFC 7841第2节。"
    },
    {
      "indent": 3,
      "text": "Information about the current status of this document, any errata, and how to provide feedback on it may be obtained at https://www.rfc-editor.org/info/rfc8584.",
      "zh-CHS": "有关本文件当前状态、任何勘误表以及如何提供反馈的信息，请访问https://www.rfc-editor.org/info/rfc8584."
    },
    {
      "indent": 0,
      "text": "Copyright Notice",
      "zh-CHS": "版权公告"
    },
    {
      "indent": 3,
      "text": "Copyright (c) 2019 IETF Trust and the persons identified as the document authors. All rights reserved.",
      "zh-CHS": "版权（c）2019 IETF信托基金和被确定为文件作者的人员。版权所有。"
    },
    {
      "indent": 3,
      "text": "This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (https://trustee.ietf.org/license-info) in effect on the date of publication of this document. Please review these documents carefully, as they describe your rights and restrictions with respect to this document. Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.",
      "zh-CHS": "本文件受BCP 78和IETF信托有关IETF文件的法律规定的约束(https://trustee.ietf.org/license-info)自本文件出版之日起生效。请仔细阅读这些文件，因为它们描述了您对本文件的权利和限制。从本文件中提取的代码组件必须包括信托法律条款第4.e节中所述的简化BSD许可证文本，并提供简化BSD许可证中所述的无担保。"
    },
    {
      "indent": 0,
      "text": "Table of Contents",
      "zh-CHS": "目录"
    },
    {
      "indent": 3,
      "text": "1. Introduction ....................................................3\n   1.1. Conventions and Terminology ................................3\n   1.2. Default Designated Forwarder (DF) Election in EVPN\n        Services ...................................................5\n   1.3. Problem Statement ..........................................8\n        1.3.1. Unfair Load Balancing and Service Disruption ........8\n        1.3.2. Traffic Black-Holing on Individual AC Failures .....10\n   1.4. The Need for Extending the Default DF Election in\n        EVPN Services .............................................12\n2. Designated Forwarder Election Protocol and BGP Extensions ......13\n   2.1. The DF Election Finite State Machine (FSM) ................13\n   2.2. The DF Election Extended Community ........................16\n        2.2.1. Backward Compatibility .............................19\n3. The Highest Random Weight DF Election Algorithm ................19\n   3.1. HRW and Consistent Hashing ................................20\n   3.2. HRW Algorithm for EVPN DF Election ........................20\n4. The AC-Influenced DF Election Capability .......................22\n   4.1. AC-Influenced DF Election Capability for\n        VLAN-Aware Bundle Services ................................24\n5. Solution Benefits ..............................................25\n6. Security Considerations ........................................26\n7. IANA Considerations ............................................27\n8. References .....................................................28\n   8.1. Normative References ......................................28\n   8.2. Informative References ....................................29\nAcknowledgments ...................................................30\nContributors ......................................................30\nAuthors' Addresses ................................................31",
      "raw": true,
      "toc": true,
      "zh-CHS": " "
    },
    {
      "indent": 0,
      "text": "1. Introduction",
      "section_title": true,
      "zh-CHS": "1. 介绍"
    },
    {
      "indent": 3,
      "text": "The Designated Forwarder (DF) in Ethernet VPNs (EVPNs) is the Provider Edge (PE) router responsible for sending Broadcast, Unknown Unicast, and Multicast (BUM) traffic to a multihomed Customer Edge (CE) device on a given VLAN on a particular Ethernet Segment (ES). The DF is elected from the set of multihomed PEs attached to a given ES, each of which advertises an ES route for the ES as identified by its Ethernet Segment Identifier (ESI). By default, the EVPN uses a DF election algorithm referred to as \"service carving\". The DF election algorithm is based on a modulus function (V mod N) that takes the number of PEs in the ES (N) and the VLAN value (V) as input. This document addresses inefficiencies in the default DF election algorithm by defining a new DF election algorithm and an ability to influence the DF election result for a VLAN, depending on the state of the associated Attachment Circuit (AC). In order to avoid any ambiguity with the identifier used in the DF election algorithm, this document uses the term \"Ethernet Tag\" instead of \"VLAN\". This document also creates a registry with IANA for future DF election algorithms and capabilities (see Section 7). It also presents a formal definition and clarification of the DF election Finite State Machine (FSM). Therefore, this document updates [RFC7432], and EVPN implementations MUST conform to the prescribed FSM.",
      "zh-CHS": "以太网VPN（EVPN）中的指定转发器（DF）是提供商边缘（PE）路由器，负责将广播、未知单播和多播（BUM）流量发送到特定以太网段（ES）上给定VLAN上的多宿客户边缘（CE）设备。DF从连接到给定ES的多宿PE集合中选择，每个多宿PE为ES播发由其以太网段标识符（ESI）标识的ES路由。默认情况下，EVPN使用称为“服务雕刻”的DF选择算法。DF选择算法基于模函数（V mod N），该模函数将ES中的PE数（N）和VLAN值（V）作为输入。本文档通过定义新的DF选择算法以及根据相关连接电路（AC）的状态影响VLAN的DF选择结果的能力来解决默认DF选择算法中的低效问题。为了避免与DF选择算法中使用的标识符产生歧义，本文件使用术语“以太网标签”而不是“VLAN”。本文档还使用IANA创建了一个注册表，用于将来的DF选择算法和功能（参见第7节）。它还提出了DF选举有限状态机（FSM）的正式定义和澄清。因此，本文件更新了[RFC7432]，EVPN实施必须符合规定的FSM。"
    },
    {
      "indent": 3,
      "text": "The procedures described in this document apply to DF election in all EVPN solutions, including those described in [RFC7432] and [RFC8214]. Apart from the formal description of the FSM, this document does not intend to update other procedures described in [RFC7432]; it only aims to improve the behavior of the DF election on PEs that are upgraded to follow the procedures described in this document.",
      "zh-CHS": "本文件中描述的程序适用于所有EVPN解决方案中的DF选择，包括[RFC7432]和[RFC8214]中描述的程序。除FSM的正式说明外，本文件不打算更新[RFC7432]中所述的其他程序；其目的仅在于改进PEs上DF选举的行为，这些PEs已升级为遵循本文件中所述的程序。"
    },
    {
      "indent": 0,
      "text": "1.1. Conventions and Terminology",
      "section_title": true,
      "zh-CHS": "1.1. 公约和术语"
    },
    {
      "indent": 3,
      "text": "The key words \"MUST\", \"MUST NOT\", \"REQUIRED\", \"SHALL\", \"SHALL NOT\", \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"NOT RECOMMENDED\", \"MAY\", and \"OPTIONAL\" in this document are to be interpreted as described in BCP 14 [RFC2119] [RFC8174] when, and only when, they appear in all capitals, as shown here.",
      "zh-CHS": "本文件中的关键词“必须”、“不得”、“必需”、“应”、“不应”、“建议”、“不建议”、“可”和“可选”在所有大写字母出现时（如图所示）应按照BCP 14[RFC2119][RFC8174]所述进行解释。"
    },
    {
      "indent": 3,
      "text": "o AC: Attachment Circuit. An AC has an Ethernet Tag associated with it.",
      "zh-CHS": "o 交流：连接电路。AC具有与其关联的以太网标签。"
    },
    {
      "indent": 3,
      "text": "o ACS: Attachment Circuit Status.",
      "zh-CHS": "o ACS：附件电路状态。"
    },
    {
      "indent": 3,
      "text": "o BUM: Broadcast, unknown unicast, and multicast.",
      "zh-CHS": "o BUM：广播、未知单播和多播。"
    },
    {
      "indent": 3,
      "text": "o DF: Designated Forwarder.",
      "zh-CHS": "o DF：指定货代。"
    },
    {
      "indent": 3,
      "text": "o NDF: Non-Designated Forwarder.",
      "zh-CHS": "o NDF：非指定货代。"
    },
    {
      "indent": 3,
      "text": "o BDF: Backup Designated Forwarder.",
      "zh-CHS": "o BDF：备份指定的转发器。"
    },
    {
      "indent": 3,
      "text": "o Ethernet A-D per ES route: Refers to Route Type 1 as defined in [RFC7432] or to Auto-discovery per Ethernet Segment route.",
      "zh-CHS": "o 每个ES路由的以太网A-D：指[RFC7432]中定义的路由类型1或每个以太网段路由的自动发现。"
    },
    {
      "indent": 3,
      "text": "o Ethernet A-D per EVI route: Refers to Route Type 1 as defined in [RFC7432] or to Auto-discovery per EVPN Instance route.",
      "zh-CHS": "o 每个EVI路由的以太网A-D：指[RFC7432]中定义的路由类型1或每个EVPN实例路由的自动发现。"
    },
    {
      "indent": 3,
      "text": "o ES: Ethernet Segment.",
      "zh-CHS": "o 以太网段。"
    },
    {
      "indent": 3,
      "text": "o ESI: Ethernet Segment Identifier.",
      "zh-CHS": "o ESI：以太网段标识符。"
    },
    {
      "indent": 3,
      "text": "o EVI: EVPN Instance.",
      "zh-CHS": "o EVI:EVPN实例。"
    },
    {
      "indent": 3,
      "text": "o MAC-VRF: A Virtual Routing and Forwarding table for Media Access Control (MAC) addresses on a PE.",
      "zh-CHS": "o MAC-VRF：PE上媒体访问控制（MAC）地址的虚拟路由和转发表。"
    },
    {
      "indent": 3,
      "text": "o BD: Broadcast Domain. An EVI may be comprised of one BD (VLAN-based or VLAN Bundle services) or multiple BDs (VLAN-aware Bundle services).",
      "zh-CHS": "o BD：广播域。EVI可以由一个BD（基于VLAN或VLAN捆绑服务）或多个BDs（支持VLAN的捆绑服务）组成。"
    },
    {
      "indent": 3,
      "text": "o Bridge table: An instantiation of a BD on a MAC-VRF.",
      "zh-CHS": "o 桥接表：MAC-VRF上BD的实例。"
    },
    {
      "indent": 3,
      "text": "o HRW: Highest Random Weight.",
      "zh-CHS": "o HRW：最高随机权重。"
    },
    {
      "indent": 3,
      "text": "o VID: VLAN Identifier.",
      "zh-CHS": "o VID:VLAN标识符。"
    },
    {
      "indent": 3,
      "text": "o CE-VID: Customer Edge VLAN Identifier.",
      "zh-CHS": "o CE-VID：客户边缘VLAN标识符。"
    },
    {
      "indent": 3,
      "text": "o Ethernet Tag: Used to represent a BD that is configured on a given ES for the purpose of DF election. Note that any of the following may be used to represent a BD: VIDs (including Q-in-Q tags), configured IDs, VNIs (Virtual Extensible Local Area Network (VXLAN) Network Identifiers), normalized VIDs, I-SIDs (Service Instance Identifiers), etc., as long as the representation of the BDs is configured consistently across the multihomed PEs attached to that ES. The Ethernet Tag value MUST be different from zero.",
      "zh-CHS": "o 以太网标签：用于表示在给定ES上配置的BD，用于选择DF。注意，以下任一项可用于表示BD:VIDs（包括Q-in-Q标签）、配置的ID、VNI（虚拟可扩展局域网（VXLAN）网络标识符）、规范化VIDs、I-SID（服务实例标识符）等。，只要BDs的表示形式在连接到该ES的多址PE中配置一致。以太网标记值必须不同于零。"
    },
    {
      "indent": 3,
      "text": "o Ethernet Tag ID: Refers to the identifier used in the EVPN routes defined in [RFC7432]. Its value may be the same as the Ethernet Tag value (see the definition for Ethernet Tag) when advertising routes for VLAN-aware Bundle services. Note that in the case of VLAN-based or VLAN Bundle services, the Ethernet Tag ID is zero.",
      "zh-CHS": "o 以太网标记ID：指[RFC7432]中定义的EVPN路由中使用的标识符。当为支持VLAN的捆绑服务发布路由时，其值可能与以太网标签值相同（请参阅以太网标签的定义）。请注意，在基于VLAN或VLAN捆绑服务的情况下，以太网标记ID为零。"
    },
    {
      "indent": 3,
      "text": "o DF election procedure: Also called \"DF election\". Refers to the process in its entirety, including the discovery of the PEs in the ES, the creation and maintenance of the PE candidate list, and the selection of a PE.",
      "zh-CHS": "o DF选举程序：也称为“DF选举”。指整个过程，包括在ES中发现PE、创建和维护PE候选列表以及选择PE。"
    },
    {
      "indent": 3,
      "text": "o DF algorithm: A component of the DF election procedure. Strictly refers to the selection of a PE for a given <ES, Ethernet Tag>.",
      "zh-CHS": "o DF算法：DF选举程序的一个组成部分。严格地说，是指为给定的<ES，Ethernet Tag>选择PE。"
    },
    {
      "indent": 3,
      "text": "o RR: Route Reflector. A network routing component for BGP [RFC4456]. It offers an alternative to the logical full-mesh requirement of the Internal Border Gateway Protocol (IBGP). The purpose of the RR is concentration. Multiple BGP routers can peer with a central point, the RR -- acting as a route reflector server -- rather than peer with every other router in a full mesh. This results in an O(N) peering as opposed to O(N^2).",
      "zh-CHS": "o RR：路由反射器。BGP[RFC4456]的网络路由组件。它提供了内部边界网关协议（IBGP）的逻辑全网格要求的替代方案。RR的目的是浓缩。多个BGP路由器可以与一个中心点（作为路由反射器服务器的RR）进行对等，而不是与一个完整网格中的所有其他路由器进行对等。这会导致O（N）对等，而不是O（N^2）。"
    },
    {
      "indent": 3,
      "text": "o TTL: Time To Live.",
      "zh-CHS": "o TTL：该活了。"
    },
    {
      "indent": 3,
      "text": "This document also assumes that the reader is familiar with the terminology provided in [RFC7432].",
      "zh-CHS": "本文档还假设读者熟悉[RFC7432]中提供的术语。"
    },
    {
      "indent": 0,
      "text": "1.2. Default Designated Forwarder (DF) Election in EVPN Services",
      "section_title": true,
      "zh-CHS": "1.2. EVPN服务中的默认指定转发器（DF）选择"
    },
    {
      "indent": 3,
      "text": "[RFC7432] defines the DF as the EVPN PE responsible for:",
      "zh-CHS": "[RFC7432]将DF定义为EVPN PE，负责："
    },
    {
      "indent": 3,
      "text": "o Flooding BUM traffic on a given Ethernet Tag on a particular ES to the CE. This is valid for Single-Active and All-Active EVPN multihoming.",
      "zh-CHS": "o 将特定ES上给定以太网标签上的BUM流量泛洪到CE。这适用于单激活和全激活EVPN多宿。"
    },
    {
      "indent": 3,
      "text": "o Sending unicast traffic on a given Ethernet Tag on a particular ES to the CE. This is valid for Single-Active multihoming.",
      "zh-CHS": "o 向CE发送特定ES上给定以太网标签上的单播通信量。这对单激活多归宿有效。"
    },
    {
      "indent": 3,
      "text": "Figure 1 illustrates an example that we will use to explain the DF function.",
      "zh-CHS": "图1展示了一个示例，我们将使用它来解释DF函数。"
    },
    {
      "indent": 10,
      "text": "              +---------------+\n              |   IP/MPLS     |\n              |   Core        |\n+----+ ES1 +----+           +----+\n| CE1|-----|    |           |    |____ES2\n+----+     | PE1|           | PE2|    \\\n           |    |           +----+     \\+----+\n           +----+             |         | CE2|\n              |             +----+     /+----+\n              |             |    |____/   |\n              |             | PE3|    ES2 /\n              |             +----+       /\n              |               |         /\n              +-------------+----+     /\n                            | PE4|____/ES2\n                            |    |\n                            +----+",
      "raw": true,
      "zh-CHS": " "
    },
    {
      "indent": 24,
      "text": "Figure 1: EVPN Multihoming",
      "zh-CHS": "图1:EVPN多归宿"
    },
    {
      "indent": 3,
      "text": "Figure 1 illustrates a case where there are two ESes: ES1 and ES2. PE1 is attached to CE1 via ES1, whereas PE2, PE3, and PE4 are attached to CE2 via ES2, i.e., PE2, PE3, and PE4 form a redundancy group. Since CE2 is multihomed to different PEs on the same ES, it is necessary for PE2, PE3, and PE4 to agree on a DF to satisfy the above-mentioned requirements.",
      "zh-CHS": "图1说明了存在两个ESE的情况：ES1和ES2。PE1通过ES1连接到CE1，而PE2、PE3和PE4通过ES2连接到CE2，即PE2、PE3和PE4形成冗余组。由于CE2在同一ES上多宿于不同的PE，因此PE2、PE3和PE4有必要就DF达成一致，以满足上述要求。"
    },
    {
      "indent": 3,
      "text": "The effect of forwarding loops in a Layer 2 network is particularly severe because of the broadcast nature of Ethernet traffic and the lack of a TTL. Therefore, it is very important that, in the case of a multihomed CE, only one of the PEs be used to send BUM traffic to it.",
      "zh-CHS": "由于以太网流量的广播性质和TTL的缺乏，第2层网络中转发环路的影响尤其严重。因此，在多址CE的情况下，仅使用一个PE向其发送BUM流量是非常重要的。"
    },
    {
      "indent": 3,
      "text": "One of the prerequisites for this support is that participating PEs must agree amongst themselves as to who would act as the DF. This needs to be achieved through a distributed algorithm in which each participating PE independently and unambiguously selects one of the participating PEs as the DF, and the result should be consistent and unanimous.",
      "zh-CHS": "这种支持的先决条件之一是，参与PEs必须就谁将担任DF达成一致。这需要通过分布式算法实现，其中每个参与PE独立且明确地选择其中一个参与PE作为DF，并且结果应一致。"
    },
    {
      "indent": 3,
      "text": "The default algorithm for DF election defined by [RFC7432] at the granularity of (ESI, EVI) is referred to as \"service carving\". In this document, service carving and the default DF election algorithm are used interchangeably. With service carving, it is possible to elect multiple DFs per ES (one per EVI) in order to perform load",
      "zh-CHS": "[RFC7432]以（ESI，EVI）粒度定义的DF选举的默认算法称为“服务分割”。在本文档中，服务雕刻和默认的DF选择算法可以互换使用。使用service carving，可以为每个ES选择多个DFs（每个EVI一个），以便执行加载"
    },
    {
      "indent": 3,
      "text": "balancing of traffic destined to a given ES. The objective is that the load-balancing procedures should carve up the BD space among the redundant PE nodes evenly, in such a way that every PE is the DF for a distinct set of EVIs.",
      "zh-CHS": "目的地为给定ES的流量平衡。目标是负载平衡过程应在冗余PE节点之间均匀地划分BD空间，以这样的方式，每个PE都是一组不同EVI的DF。"
    },
    {
      "indent": 3,
      "text": "The DF election algorithm (as described in [RFC7432], Section 8.5) is based on a modulus operation. The PEs to which the ES (for which DF election is to be carried out per EVI) is multihomed form an ordered (ordinal) list in ascending order by PE IP address value. For example, there are N PEs: PE0, PE1,... PE(N-1) ranked as per increasing IP addresses in the ordinal list; then, for each VLAN with Ethernet Tag V, configured on ES1, PEx is the DF for VLAN V on ES1 when x equals (V mod N). In the case of a VLAN Bundle, only the lowest VLAN is used. In the case when the planned density is high (meaning there are a significant number of VLANs and the Ethernet Tags are uniformly distributed), the thinking is that the DF election will be spread across the PEs hosting that ES and good load balancing can be achieved.",
      "zh-CHS": "DF选择算法（如[RFC7432]第8.5节所述）基于模运算。ES（每个EVI将对其执行DF选择）多址的PE按照PE IP地址值的升序形成有序（顺序）列表。例如，有N个PEs:PE0，PE1，。。。PE（N-1）按顺序列表中IP地址的增加排序；然后，对于ES1上配置的每个带有以太网标签V的VLAN，当x等于（V mod N）时，PEx是ES1上VLAN V的DF。在VLAN捆绑的情况下，仅使用最低的VLAN。在计划密度较高的情况下（意味着存在大量VLAN且以太网标签均匀分布），我们的想法是DF选择将分布在PEs主机上，这样可以实现ES和良好的负载平衡。"
    },
    {
      "indent": 3,
      "text": "However, the described default DF election algorithm has some undesirable properties and, in some cases, can be somewhat disruptive and unfair. This document describes some of those issues and defines a mechanism for dealing with them. These mechanisms do involve changes to the default DF election algorithm, but they do not require any changes to the EVPN route exchange, and changes in the EVPN routes will be minimal.",
      "zh-CHS": "然而，所描述的默认DF选举算法具有一些不希望的特性，并且在某些情况下可能具有一定的破坏性和不公平性。本文档描述了其中的一些问题，并定义了处理这些问题的机制。这些机制确实涉及对默认DF选举算法的更改，但它们不需要对EVPN路由交换进行任何更改，并且EVPN路由的更改将是最小的。"
    },
    {
      "indent": 3,
      "text": "In addition, there is a need to extend the DF election procedures so that new algorithms and capabilities are possible. A single algorithm (the default DF election algorithm) may not meet the requirements in all the use cases.",
      "zh-CHS": "此外，还需要扩展DF选举程序，以使新的算法和功能成为可能。单个算法（默认的DF选择算法）可能无法满足所有用例中的要求。"
    },
    {
      "indent": 3,
      "text": "Note that while [RFC7432] elects a DF per <ES, EVI>, this document elects a DF per <ES, BD>. This means that unlike [RFC7432], where for a VLAN-aware Bundle service EVI there is only one DF for the EVI, this document specifies that there will be multiple DFs, one for each BD configured in that EVI.",
      "zh-CHS": "请注意，[RFC7432]根据<ES，EVI>选择DF，而本文档根据<ES，BD>选择DF。这意味着与[RFC7432]不同，在[RFC7432]中，对于支持VLAN的捆绑服务EVI，EVI只有一个DF，本文档指定将有多个DF，该EVI中配置的每个BD一个DF。"
    },
    {
      "indent": 0,
      "text": "1.3. Problem Statement",
      "section_title": true,
      "zh-CHS": "1.3. 问题陈述"
    },
    {
      "indent": 3,
      "text": "This section describes some potential issues with the default DF election algorithm.",
      "zh-CHS": "本节介绍默认DF选举算法的一些潜在问题。"
    },
    {
      "indent": 0,
      "text": "1.3.1. Unfair Load Balancing and Service Disruption",
      "section_title": true,
      "zh-CHS": "1.3.1. 不公平的负载平衡和服务中断"
    },
    {
      "indent": 3,
      "text": "There are three fundamental problems with the current default DF election algorithm.",
      "zh-CHS": "当前默认的DF选举算法存在三个基本问题。"
    },
    {
      "indent": 3,
      "text": "1. The algorithm will not perform well when the Ethernet Tag follows a non-uniform distribution -- for instance, when the Ethernet Tags are all even or all odd. In such a case, let us assume that the ES is multihomed to two PEs; one of the PEs will be elected as the DF for all of the VLANs. This is very suboptimal. It defeats the purpose of service carving, as the DFs are not really evenly spread across the PEs hosting the ES. In fact, in this particular case, one of the PEs does not get elected as the DF at all, so it does not participate in DF responsibilities at all. Consider another example where, referring to Figure 1, let's assume that (1) PE2, PE3, and PE4 are listed in ascending order by IP address and (2) each VLAN configured on ES2 is associated with an Ethernet Tag of the form (3x+1), where x is an integer. This will result in PE3 always being selected as the DF.",
      "zh-CHS": "1. 当Ethernet标记遵循非均匀分布时（例如，当Ethernet标记全部为偶数或奇数时），该算法将无法很好地执行。在这种情况下，让我们假设ES多宿于两个PE；其中一个PE将被选为所有VLAN的DF。这是非常次优的。这违背了服务分割的目的，因为DFs并没有真正均匀地分布在托管ES的PE中。事实上，在这种特殊情况下，其中一个PEs根本没有当选为DF，因此它根本不参与DF职责。考虑另一个例子，在这里参照图1，假设（1）PE2、PE3和PE4按IP地址按升序排列，（2）在ES2上配置的每个VLAN与表单（3x+1）的以太网标签相关联，其中X是整数。这将导致始终选择PE3作为DF。"
    },
    {
      "indent": 3,
      "text": "2. The Ethernet Tag that identifies the BD can be as large as 2^24; however, it is not guaranteed that the tenant BD on the ES will conform to a uniform distribution. In fact, it is up to the customer what BDs they will configure on the ES. Quoting [Knuth]:",
      "zh-CHS": "2. 标识BD的以太网标签可以大到2^24；但是，不能保证ES上的租户BD符合统一分布。事实上，客户将在ES上配置什么样的BDs。引用[Knuth]："
    },
    {
      "indent": 10,
      "text": "In general, we want to avoid values of M that divide r^k+a or r^k-a, where k and a are small numbers and r is the radix of the alphabetic character set (usually r=64, 256 or 100), since a remainder modulo such a value of M tends to be largely a simple superposition of key digits. Such considerations suggest that we choose M to be a prime number such that r^k!=a(modulo)M or r^k!=?a(modulo)M for small k & a.",
      "zh-CHS": "通常，我们希望避免M值除以r^k+a或r^k-a，其中k和a是小数字，r是字母字符集的基数（通常为r=64、256或100），因为M值的余数模在很大程度上是键数字的简单叠加。这些考虑建议我们选择M作为质数，这样r^k=a（模）M或r^k！=？a（模）M表示小k&a。"
    },
    {
      "indent": 7,
      "text": "In our case, N is the number of PEs (Section 8.5 of [RFC7432]). N corresponds to M above. Since N, N-1, or N+1 need not satisfy the primality properties of M, as per the modulo-based DF assignment [RFC7432], whenever a PE goes down or a new PE boots up (attached to the same ES), the modulo scheme will not necessarily map BDs to PEs uniformly.",
      "zh-CHS": "在我们的例子中，N是PEs的数量（参见[RFC7432]第8.5节）。N对应于上面的M。根据基于模的DF分配[RFC7432]，由于N、N-1或N+1不需要满足M的素性属性，每当PE下降或新PE启动（连接到相同的ES），模方案不一定会将BDs均匀地映射到PEs。"
    },
    {
      "indent": 3,
      "text": "3. Disruption is another problem. Consider a case when the same ES is multihomed to a set of PEs. When the ES is DOWN in one of the PEs, say PE1, or PE1 itself reboots, or the BGP process goes down or the connectivity between PE1 and an RR goes down, the effective number of PEs in the system now becomes N-1, and DFs are computed for all the VLANs that are configured on that ES. In general, if the DF for a VLAN V happens not to be PE1, but some other PE, say PE2, it is likely that some other PE (different from PE1 and PE2) will become the new DF. This is not desirable. Similarly, when a new PE hosts the same ES, the mapping again changes because of the modulus operation. This results in needless churn. Again referring to Figure 1, say V1, V2, and V3 are VLANs configured on ES2 with associated Ethernet Tags of values 999, 1000, and 1001, respectively. So, PE1, PE2, and PE3 are the DFs for V1, V2, and V3, respectively. Now when PE3 goes down, PE2 will become the DF for V1 and PE1 will become the DF for V2.",
      "zh-CHS": "3. 破坏是另一个问题。考虑一个情况，当相同的ES是多个归宿到一组PES。当其中一个PE中的ES关闭时，例如PE1，或者PE1本身重新启动，或者BGP进程关闭，或者PE1和RR之间的连接关闭，系统中的PE的有效数量现在变为N-1，并且会为该ES上配置的所有VLAN计算DFs。一般来说，如果VLAN V的DF碰巧不是PE1，而是其他PE，比如PE2，那么其他PE（不同于PE1和PE2）很可能会成为新的DF。这是不可取的。类似地，当新PE承载相同的ES时，由于模运算，映射再次发生变化。这会导致不必要的搅动。再次参考图1，假设V1、V2和V3是ES2上配置的VLAN，其关联的以太网标签分别为999、1000和1001。因此，PE1、PE2和PE3分别是V1、V2和V3的DFs。现在，当PE3下降时，PE2将成为V1的DF，PE1将成为V2的DF。"
    },
    {
      "indent": 3,
      "text": "One point to note is that the default DF election algorithm assumes that all the PEs who are multihomed to the same ES (and interested in the DF election by exchanging EVPN routes) use an Originating Router's IP address [RFC7432] of the same family. This does not need to be the case, as the EVPN address family can be carried over an IPv4 or IPv6 peering, and the PEs attached to the same ES may use an address of either family.",
      "zh-CHS": "需要注意的一点是，默认的DF选择算法假设多址到同一ES的所有PE（并且通过交换EVPN路由对DF选择感兴趣）使用同一系列的原始路由器IP地址[RFC7432]。不需要这样，因为EVPN地址系列可以通过IPv4或IPv6对等进行传输，并且连接到相同ES的PE可以使用任一系列的地址。"
    },
    {
      "indent": 3,
      "text": "Mathematically, a conventional hash function maps a key k to a number i representing one of m hash buckets through a function h(k), i.e., i = h(k). In the EVPN case, h is simply a modulo-m hash function viz. h(V) = V mod N, where N is the number of PEs that are multihomed to the ES in question. It is well known that for good hash distribution using the modulus operation, the modulus N should be a prime number not too close to a power of 2 [CLRS2009]. When the effective number of PEs changes from N to N-1 (or vice versa), all the objects (VLAN V) will be remapped except those for which V mod N and V mod (N-1) refer to the same PE in the previous and subsequent ordinal rankings, respectively. From a forwarding perspective, this is a churn, as it results in reprogramming the PE ports as either blocking or non-blocking at the PEs where the DF state changes.",
      "zh-CHS": "从数学上讲，传统散列函数通过函数h（k）将密钥k映射到表示m个散列桶中的一个的数字i，即i＝h（k）。在EVPN的情况下，h只是一个模m散列函数，即。h（V）=V mod N，其中N是多宿到相关ES的PE的数量。众所周知，对于使用模运算的良好散列分布，模N应该是不太接近2的幂的素数[CLRS2009]。当PE的有效数量从N变为N-1（反之亦然）时，所有对象（VLAN V）都将重新映射，但V mod N和V mod（N-1）分别在先前和后续顺序排名中引用相同PE的对象除外。从转发的角度来看，这是一种搅动，因为它会导致在DF状态发生变化的PEs处将PE端口重新编程为阻塞或非阻塞。"
    },
    {
      "indent": 3,
      "text": "This document addresses this problem and furnishes a solution to this undesirable behavior.",
      "zh-CHS": "本文档解决了此问题，并提供了此不良行为的解决方案。"
    },
    {
      "indent": 0,
      "text": "1.3.2. Traffic Black-Holing on Individual AC Failures",
      "section_title": true,
      "zh-CHS": "1.3.2. 个别交流故障时的交通堵塞"
    },
    {
      "indent": 3,
      "text": "The default DF election algorithm defined by [RFC7432] takes into account only two variables in the modulus function for a given ES: the existence of the PE's IP address in the candidate list and the locally provisioned Ethernet Tags.",
      "zh-CHS": "[RFC7432]定义的默认DF选择算法只考虑给定ES的模函数中的两个变量：候选列表中PE的IP地址和本地配置的以太网标记。"
    },
    {
      "indent": 3,
      "text": "If the DF for an <ESI, EVI> fails (due to physical link/node failures), an ES route withdrawal will make the NDF PEs re-elect the DF for that <ESI, EVI> and the service will be recovered.",
      "zh-CHS": "如果<ESI，EVI>的DF失败（由于物理链路/节点故障），ES路由撤回将使NDF PE重新选择该<ESI，EVI>的DF，服务将恢复。"
    },
    {
      "indent": 3,
      "text": "However, the default DF election procedure does not provide protection against \"logical\" failures or human errors that may occur at the service level on the DF, while the list of active PEs for a given ES does not change. These failures may have an impact not only on the local PE where the issue happens but also on the rest of the PEs of the ES. Some examples of such logical failures are listed below:",
      "zh-CHS": "但是，默认的DF选择程序不提供针对DF服务级别上可能发生的“逻辑”故障或人为错误的保护，而给定ES的活动PE列表不变。这些故障不仅会影响发生问题的本地PE，还会影响ES的其他PE。下面列出了此类逻辑故障的一些示例："
    },
    {
      "indent": 3,
      "text": "(a) A given individual AC defined in an ES is accidentally shut down or is not provisioned yet (hence, the ACS is DOWN), while the ES is operationally active (since the ES route is active).",
      "zh-CHS": "(a) ES中定义的给定单个AC意外关闭或尚未设置（因此，ACS关闭），而ES处于操作活动状态（因为ES路由处于活动状态）。"
    },
    {
      "indent": 3,
      "text": "(b) A given MAC-VRF with a defined ES is either shut down or not provisioned yet, while the ES is operationally active (since the ES route is active). In this case, the ACS of all the ACs defined in that MAC-VRF is considered to be DOWN.",
      "zh-CHS": "(b) 具有已定义ES的给定MAC-VRF在ES处于操作活动状态（因为ES路由处于活动状态）时关闭或尚未设置。在这种情况下，该MAC-VRF中定义的所有ACS的ACS被视为停机。"
    },
    {
      "indent": 3,
      "text": "Neither (a) nor (b) will trigger the DF re-election on the remote multihomed PEs for a given ES, since the ACS is not taken into account in the DF election procedures. While the ACS is used as a DF election tiebreaker and trigger in Virtual Private LAN Service (VPLS) multihoming procedures [VPLS-MH], there is no procedure defined in the EVPN specification [RFC7432] to trigger the DF re-election based on the ACS change on the DF.",
      "zh-CHS": "（a）和（b）都不会触发给定ES的远程多址PEs上的DF重新选举，因为在DF选举程序中不考虑ACS。虽然ACS在虚拟专用LAN服务（VPLS）多宿过程[VPLS-MH]中用作DF选择的断开器和触发器，但EVPN规范[RFC7432]中没有定义基于DF上的ACS更改触发DF重新选择的过程。"
    },
    {
      "indent": 3,
      "text": "Figure 2 shows an example of logical AC failure.",
      "zh-CHS": "图2显示了逻辑交流故障的示例。"
    },
    {
      "indent": 7,
      "text": "                        +---+\n                        |CE4|\n                        +---+\n                          |\n                     PE4  |\n                    +-----+-----+\n    +---------------|  +-----+  |---------------+\n    |               |  | BD-1|  |               |\n    |               +-----------+               |\n    |                                           |\n    |                   EVPN                    |\n    |                                           |\n    | PE1               PE2                PE3  |\n    | (NDF)             (DF)               (NDF)|\n+-----------+       +-----------+       +-----------+\n|  | BD-1|  |       |  | BD-1|  |       |  | BD-1|  |\n|  +-----+  |-------|  +-----+  |-------|  +-----+  |\n+-----------+       +-----------+       +-----------+\n       AC1\\   ES12   /AC2  AC3\\   ES23   /AC4\n           \\        /          \\        /\n            \\      /            \\      /\n             +----+              +----+\n             |CE12|              |CE23|\n             +----+              +----+",
      "raw": true,
      "zh-CHS": " "
    },
    {
      "indent": 10,
      "text": "Figure 2: Default DF Election and Traffic Black-Holing",
      "zh-CHS": "图2：默认的DF选择和交通黑洞"
    },
    {
      "indent": 3,
      "text": "BD-1 is defined in PE1, PE2, PE3, and PE4. CE12 is a multihomed CE connected to ES12 in PE1 and PE2. Similarly, CE23 is multihomed to PE2 and PE3 using ES23. Both CE12 and CE23 are connected to BD-1 through VLAN-based service interfaces: CE12-VID 1 (VID 1 on CE12) is associated with AC1 and AC2 in BD-1, whereas CE23-VID 1 is associated with AC3 and AC4 in BD-1. Assume that, although not represented, there are other ACs defined on these ESes mapped to different BDs.",
      "zh-CHS": "BD-1在PE1、PE2、PE3和PE4中定义。CE12是连接到PE1和PE2中ES12的多宿CE。同样，使用ES23将CE23多宿到PE2和PE3。CE12和CE23都通过基于VLAN的服务接口连接到BD-1：CE12-VID 1（CE12上的VID 1）与BD-1中的AC1和AC2关联，而CE23-VID 1与BD-1中的AC3和AC4关联。假设，尽管未表示，但这些ESE上定义的其他AC映射到不同的BDs。"
    },
    {
      "indent": 3,
      "text": "After executing the default DF election algorithm as described in [RFC7432], PE2 turns out to be the DF for ES12 and ES23 in BD-1. The following issues may arise:",
      "zh-CHS": "执行[RFC7432]中所述的默认DF选择算法后，PE2变成BD-1中ES12和ES23的DF。可能出现以下问题："
    },
    {
      "indent": 3,
      "text": "(a) If AC2 is accidentally shut down or is not configured yet, CE12 traffic will be impacted. In the case of All-Active multihoming, the BUM traffic to CE12 will be \"black-holed\", whereas for Single-Active multihoming, all the traffic to/from CE12 will be discarded. This is because a logical failure in PE2's AC2 may not trigger an ES route withdrawal for ES12 (since there are still other ACs active on ES12); therefore, PE1 will not rerun the DF election procedures.",
      "zh-CHS": "(a) 如果AC2意外关闭或尚未配置，CE12流量将受到影响。在所有主动多宿的情况下，到CE12的BUM通信量将是“黑洞”，而对于单个主动多宿，到/从CE12的所有通信量将被丢弃。这是因为PE2的AC2中的逻辑故障可能不会触发ES12的ES路由退出（因为ES12上仍有其他活动的ACs）；因此，PE1不会重新运行DF选举程序。"
    },
    {
      "indent": 3,
      "text": "(b) If the bridge table for BD-1 is administratively shut down or is not configured yet on PE2, CE12 and CE23 will both be impacted: BUM traffic to both CEs will be discarded in the case of All-Active multihoming, and all traffic will be discarded to/from the CEs in the case of Single-Active multihoming. This is because PE1 and PE3 will not rerun the DF election procedures and will keep assuming that PE2 is the DF.",
      "zh-CHS": "(b) 如果BD-1的桥接表被管理性关闭或尚未在PE2上配置，CE12和CE23都将受到影响：在所有活动多宿的情况下，两个CE的BUM流量将被丢弃，在单个活动多宿的情况下，所有流量将被丢弃到/从CEs。这是因为PE1和PE3不会重新运行DF选举程序，并将继续假设PE2是DF。"
    },
    {
      "indent": 3,
      "text": "Quoting [RFC7432], \"When an Ethernet tag is decommissioned on an Ethernet segment, then the PE MUST withdraw the Ethernet A-D per EVI route(s) announced for the <ESI, Ethernet tags> that are impacted by the decommissioning.\" However, while this A-D per EVI route withdrawal is used at the remote PEs performing aliasing or backup procedures, it is not used to influence the DF election for the affected EVIs.",
      "zh-CHS": "引用[RFC7432]，“当以太网段上的以太网标签停用时，PE必须按照为受停用影响的<ESI，以太网标签>宣布的EVI路由撤回以太网A-D。”然而，尽管此A-D per-EVI路由撤回用于远程PE执行别名或备份过程，它不用于影响受影响EVI的DF选举。"
    },
    {
      "indent": 3,
      "text": "This document adds an optional modification of the DF election procedure so that the ACS may be taken into account as a variable in the DF election; therefore, EVPN can provide protection against logical failures.",
      "zh-CHS": "本文件增加了DF选择程序的可选修改，以便在DF选择中考虑ACS作为变量；因此，EVPN可以针对逻辑故障提供保护。"
    },
    {
      "indent": 0,
      "text": "1.4. The Need for Extending the Default DF Election in EVPN Services",
      "section_title": true,
      "zh-CHS": "1.4. 在EVPN服务中扩展默认DF选择的必要性"
    },
    {
      "indent": 3,
      "text": "Section 1.3 describes some of the issues that exist in the default DF election procedures. In order to address those issues, this document introduces a new DF election framework. This framework allows the PEs to agree on a common DF election algorithm, as well as the capabilities to enable during the DF election procedure. Generally, \"DF election algorithm\" refers to the algorithm by which a number of input parameters are used to determine the DF PE, while \"DF election capability\" refers to an additional feature that can be used prior to the invocation of the DF election algorithm, such as modifying the inputs (or list of candidate PEs).",
      "zh-CHS": "第1.3节描述了默认DF选举程序中存在的一些问题。为了解决这些问题，本文件介绍了一个新的民主阵线选举框架。该框架允许PEs就共同的DF选举算法以及在DF选举过程中启用的功能达成一致。通常，“DF选举算法”是指使用大量输入参数来确定DF PE的算法，而“DF选举能力”是指在调用DF选举算法之前可以使用的附加功能，例如修改输入（或候选PE列表）。"
    },
    {
      "indent": 3,
      "text": "Within this framework, this document defines a new DF election algorithm and a new capability that can influence the DF election result:",
      "zh-CHS": "在此框架内，本文件定义了一种新的DF选举算法和一种新的能力，可影响DF选举结果："
    },
    {
      "indent": 3,
      "text": "o The new DF election algorithm is referred to as \"Highest Random Weight\" (HRW). The HRW procedures are described in Section 3.",
      "zh-CHS": "o 新的DF选举算法被称为“最高随机权重”（HRW）。HRW程序见第3节。"
    },
    {
      "indent": 3,
      "text": "o The new DF election capability is referred to as \"AC-Influenced DF election\" (AC-DF). The AC-DF procedures are described in Section 4.",
      "zh-CHS": "o 新的DF选择能力称为“AC影响DF选择”（AC-DF）。第4节介绍了AC-DF程序。"
    },
    {
      "indent": 3,
      "text": "o HRW and AC-DF mechanisms are independent of each other. Therefore, a PE may support either HRW or AC-DF independently or may support both of them together. A PE may also support the AC-DF capability along with the default DF election algorithm per [RFC7432].",
      "zh-CHS": "o HRW和AC-DF机制相互独立。因此，PE可以独立支持HRW或AC-DF，也可以同时支持两者。PE还可以支持AC-DF功能以及[RFC7432]规定的默认DF选择算法。"
    },
    {
      "indent": 3,
      "text": "In addition, this document defines a way to indicate the support of HRW and/or AC-DF along with the EVPN ES routes advertised for a given ES. Refer to Section 2.2 for more details.",
      "zh-CHS": "此外，本文件定义了一种方式，以表明对HRW和/或AC-DF以及针对给定ES的EVPN ES路线的支持。有关更多详细信息，请参阅第2.2节。"
    },
    {
      "indent": 0,
      "text": "2. Designated Forwarder Election Protocol and BGP Extensions",
      "section_title": true,
      "zh-CHS": "2. 指定转发器选择协议和BGP扩展"
    },
    {
      "indent": 3,
      "text": "This section describes the BGP extensions required to support the new DF election procedures. In addition, since the EVPN specification [RFC7432] leaves several questions open as to the precise FSM behavior of the DF election, Section 2.1 precisely describes the intended behavior.",
      "zh-CHS": "本节描述了支持新的DF选举程序所需的BGP扩展。此外，由于EVPN规范[RFC7432]对DF选举的精确FSM行为留下了几个问题，因此第2.1节精确描述了预期行为。"
    },
    {
      "indent": 0,
      "text": "2.1. The DF Election Finite State Machine (FSM)",
      "section_title": true,
      "zh-CHS": "2.1. 有限状态机（FSM）"
    },
    {
      "indent": 3,
      "text": "Per [RFC7432], the FSM shown in Figure 3 is executed per <ES, VLAN> in the case of VLAN-based service or <ES, [VLANs in VLAN Bundle]> in the case of a VLAN Bundle on each participating PE. Note that the FSM is conceptual. Any design or implementation MUST comply with behavior that is equivalent to the behavior outlined in this FSM.",
      "zh-CHS": "根据[RFC7432]，对于基于VLAN的服务，图3中所示的FSM按照<ES，VLAN>执行；对于每个参与PE上的VLAN束，图3中所示的FSM按照<ES，[VLAN在VLAN束中]>执行。请注意，FSM是概念性的。任何设计或实现都必须遵守与本FSM中概述的行为等效的行为。"
    },
    {
      "indent": 5,
      "text": "                VLAN_CHANGE                VLAN_CHANGE\n                RCVD_ES                    RCVD_ES\n                LOST_ES                    LOST_ES\n                +----+                     +-------+\n                |    |                     |       v\n                |  +-+----+   ES_UP       ++-------++\n                +->+ INIT +-------------->+ DF_WAIT |\n                   ++-----+               +-------+-+\n                    ^                             |\n+-----------+       |                             |DF_TIMER\n| ANY_STATE +-------+         VLAN_CHANGE         |\n+-----------+ ES_DOWN    +-----------------+      |\n                         |    RCVD_ES      v      v\n                +--------++   LOST_ES     ++------+-+\n                | DF_DONE +<--------------+ DF_CALC +<-+\n                +---------+   CALCULATED  +-------+-+  |\n                                                  |    |\n                                                  +----+\n                                                  VLAN_CHANGE\n                                                  RCVD_ES\n                                                  LOST_ES",
      "raw": true,
      "zh-CHS": " "
    },
    {
      "indent": 16,
      "text": "Figure 3: DF Election Finite State Machine",
      "zh-CHS": "图3:DF选举有限状态机"
    },
    {
      "indent": 3,
      "text": "Observe that each EVI is locally configured on each of the multihomed PEs attached to a given ES and that the FSM does not provide any protection against inconsistent configuration between these PEs. That is, for a given EVI, one or more of the PEs are inadvertently configured with a different set of VLANs for a VLAN-aware Bundle service or with different VLANs for a VLAN-based service.",
      "zh-CHS": "请注意，每个EVI都是在连接到给定ES的每个多宿PE上本地配置的，并且FSM不会针对这些PE之间的不一致配置提供任何保护。也就是说，对于给定EVI，一个或多个pe被无意中配置为具有VLAN感知的捆绑服务的不同VLAN集或基于VLAN的服务的不同VLAN。"
    },
    {
      "indent": 3,
      "text": "The states and events shown in Figure 3 are defined as follows.",
      "zh-CHS": "图3所示的状态和事件定义如下。"
    },
    {
      "indent": 3,
      "text": "States:",
      "zh-CHS": "国家："
    },
    {
      "indent": 3,
      "text": "1. INIT: Initial state.",
      "zh-CHS": "1. INIT：初始状态。"
    },
    {
      "indent": 3,
      "text": "2. DF_WAIT: State in which the participant waits for enough information to perform the DF election for the EVI/ESI/VLAN combination.",
      "zh-CHS": "2. DF_WAIT：参与者等待足够的信息来为EVI/ESI/VLAN组合执行DF选择的状态。"
    },
    {
      "indent": 3,
      "text": "3. DF_CALC: State in which the new DF is recomputed.",
      "zh-CHS": "3. DF_CALC：重新计算新DF的状态。"
    },
    {
      "indent": 3,
      "text": "4. DF_DONE: State in which the corresponding DF for the EVI/ESI/VLAN combination has been elected.",
      "zh-CHS": "4. DF_DONE：为EVI/ESI/VLAN组合选择相应DF的状态。"
    },
    {
      "indent": 3,
      "text": "5. ANY_STATE: Refers to any of the above states.",
      "zh-CHS": "5. 任何状态：指上述任何状态。"
    },
    {
      "indent": 3,
      "text": "Events:",
      "zh-CHS": "活动："
    },
    {
      "indent": 3,
      "text": "1. ES_UP: The ES has been locally configured as \"UP\".",
      "zh-CHS": "1. ES_UP：ES已在本地配置为“UP”。"
    },
    {
      "indent": 3,
      "text": "2. ES_DOWN: The ES has been locally configured as \"DOWN\".",
      "zh-CHS": "2. ES_DOWN：ES已在本地配置为“DOWN”。"
    },
    {
      "indent": 3,
      "text": "3. VLAN_CHANGE: The VLANs configured in a bundle (that uses the ES) changed. This event is necessary for VLAN Bundles only.",
      "zh-CHS": "3. VLAN_更改：在捆绑包（使用ES）中配置的VLAN已更改。此事件仅对VLAN捆绑包是必需的。"
    },
    {
      "indent": 3,
      "text": "4. DF_TIMER: DF timer [RFC7432] (referred to as \"Wait timer\" in this document) has expired.",
      "zh-CHS": "4. DF_定时器：DF定时器[RFC7432]（在本文档中称为“等待定时器”）已过期。"
    },
    {
      "indent": 3,
      "text": "5. RCVD_ES: A new or changed ES route is received in an Update message with an MP_REACH_NLRI. Receiving an unchanged Update MUST NOT trigger this event.",
      "zh-CHS": "5. RCVD_ES：在带有MP_REACH_NLRI的更新消息中接收到新的或更改的ES路由。接收未更改的更新不能触发此事件。"
    },
    {
      "indent": 3,
      "text": "6. LOST_ES: An Update message with an MP_UNREACH_NLRI for a previously received ES route has been received. If such a message is seen for a route that has not been advertised previously, the event MUST NOT be triggered.",
      "zh-CHS": "6. 丢失的ES：已收到以前收到的ES路由的带有MP_UNREACH_NLRI的更新消息。如果在之前未公布的路由中看到此类消息，则不得触发该事件。"
    },
    {
      "indent": 3,
      "text": "7. CALCULATED: DF has been successfully calculated.",
      "zh-CHS": "7. 已计算：DF已成功计算。"
    },
    {
      "indent": 3,
      "text": "Corresponding actions when transitions are performed or states are entered/exited:",
      "zh-CHS": "执行转换或输入/退出状态时的相应操作："
    },
    {
      "indent": 3,
      "text": "1. ANY_STATE on ES_DOWN: (i) Stop the DF Wait timer. (ii) Assume an NDF for the local PE.",
      "zh-CHS": "1. ES_DOWN上的任何_状态：（i）停止DF等待计时器。（ii）假设本地PE为NDF。"
    },
    {
      "indent": 3,
      "text": "2. INIT on ES_UP: Transition to DF_WAIT.",
      "zh-CHS": "2. 启动时初始化：转换到DF_WAIT。"
    },
    {
      "indent": 3,
      "text": "3. INIT on VLAN_CHANGE, RCVD_ES, or LOST_ES: Do nothing.",
      "zh-CHS": "3. VLAN更改、RCVD或丢失时初始化：不执行任何操作。"
    },
    {
      "indent": 3,
      "text": "4. DF_WAIT on entering the state: (i) Start the DF Wait timer if not started already or expired. (ii) Assume an NDF for the local PE.",
      "zh-CHS": "4. 进入状态时DF_等待：（i）如果DF等待计时器尚未启动或已过期，则启动DF等待计时器。（ii）假设本地PE为NDF。"
    },
    {
      "indent": 3,
      "text": "5. DF_WAIT on VLAN_CHANGE, RCVD_ES, or LOST_ES: Do nothing.",
      "zh-CHS": "5. DF_等待VLAN更改、RCVD_ES或丢失：什么也不做。"
    },
    {
      "indent": 3,
      "text": "6. DF_WAIT on DF_TIMER: Transition to DF_CALC.",
      "zh-CHS": "6. DF_等待DF_计时器：转换到DF_计算。"
    },
    {
      "indent": 3,
      "text": "7. DF_CALC on entering or re-entering the state: (i) Rebuild the candidate list, perform a hash, and perform the election. (ii) Afterwards, the FSM generates a CALCULATED event against itself.",
      "zh-CHS": "7. DF_CALC在进入或重新进入状态时：（i）重建候选列表，执行哈希，并执行选举。（ii）之后，FSM针对其自身生成计算事件。"
    },
    {
      "indent": 3,
      "text": "8. DF_CALC on VLAN_CHANGE, RCVD_ES, or LOST_ES: Do as prescribed in Transition 7.",
      "zh-CHS": "8. VLAN更改、RCVD或丢失时的DF计算：按照转换7中的规定执行。"
    },
    {
      "indent": 3,
      "text": "9. DF_CALC on CALCULATED: Mark the election result for the VLAN or bundle, and transition to DF_DONE.",
      "zh-CHS": "9. DF_CALC on CALCULATED：标记VLAN或捆绑包的选择结果，并转换到DF_DONE。"
    },
    {
      "indent": 3,
      "text": "10. DF_DONE on exiting the state: If a new DF election is triggered and the current DF is lost, then assume an NDF for the local PE for the VLAN or VLAN Bundle.",
      "zh-CHS": "10. 退出状态时DF_完成：如果触发了新的DF选择且当前DF丢失，则假设VLAN或VLAN捆绑的本地PE有NDF。"
    },
    {
      "indent": 3,
      "text": "11. DF_DONE on VLAN_CHANGE, RCVD_ES, or LOST_ES: Transition to DF_CALC.",
      "zh-CHS": "11. 在VLAN更改、RCVD或丢失时完成DF：转换到DF计算。"
    },
    {
      "indent": 3,
      "text": "The above events and transitions are defined for the default DF election algorithm. As described in Section 4, the use of the AC-DF capability introduces additional events and transitions.",
      "zh-CHS": "上述事件和转换是为默认的DF选举算法定义的。如第4节所述，AC-DF能力的使用引入了额外的事件和转换。"
    },
    {
      "indent": 0,
      "text": "2.2. The DF Election Extended Community",
      "section_title": true,
      "zh-CHS": "2.2. 民主阵线选举扩大了社区"
    },
    {
      "indent": 3,
      "text": "For the DF election procedures to be consistent and unanimous, it is necessary that all the participating PEs agree on the DF election algorithm and capabilities to be used. For instance, it is not possible for some PEs to continue to use the default DF election algorithm while some PEs use HRW. For brownfield deployments and for interoperability with legacy PEs, it is important that all PEs have the ability to fall back on the default DF election. A PE can indicate its willingness to support HRW and/or AC-DF by signaling a DF Election Extended Community along with the ES route (Route Type 4).",
      "zh-CHS": "为了使DF选举程序一致，所有参与PEs必须就DF选举算法和使用的能力达成一致。例如，某些PE不可能继续使用默认的DF选举算法，而某些PE使用HRW。对于棕地部署和与传统PEs的互操作性，所有PEs都有能力依赖默认的DF选择，这一点很重要。PE可通过向DF选举扩展社区以及ES路线（路线类型4）发送信号，表明其支持HRW和/或AC-DF的意愿。"
    },
    {
      "indent": 3,
      "text": "The DF Election Extended Community is a new BGP transitive Extended Community attribute [RFC4360] that is defined to identify the DF election procedure to be used for the ES. Figure 4 shows the encoding of the DF Election Extended Community.",
      "zh-CHS": "DF选举扩展社区是一个新的BGP可传递扩展社区属性[RFC4360]，定义该属性是为了标识ES使用的DF选举过程。图4显示了DF选举扩展社区的编码。"
    },
    {
      "indent": 5,
      "text": " 0                   1                   2                   3\n 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n| Type = 0x06   | Sub-Type(0x06)| RSV |  DF Alg |    Bitmap     ~\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n~     Bitmap    |            Reserved                           |\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+",
      "raw": true,
      "zh-CHS": " "
    },
    {
      "indent": 17,
      "text": "Figure 4: DF Election Extended Community",
      "zh-CHS": "图4:DF选举扩展社区"
    },
    {
      "indent": 3,
      "text": "Where:",
      "zh-CHS": "哪里："
    },
    {
      "indent": 3,
      "text": "o Type: 0x06, as registered with IANA (Section 7) for EVPN Extended Communities.",
      "zh-CHS": "o 类型：0x06，在IANA注册（第7节），用于EVPN扩展社区。"
    },
    {
      "indent": 3,
      "text": "o Sub-Type: 0x06. \"DF Election Extended Community\", as registered with IANA.",
      "zh-CHS": "o 子类型：0x06。“DF选举扩展社区”，在IANA注册。"
    },
    {
      "indent": 3,
      "text": "o RSV/Reserved: Reserved bits for information that is specific to DF Alg.",
      "zh-CHS": "o RSV/保留：特定于DF Alg的信息的保留位。"
    },
    {
      "indent": 3,
      "text": "o DF Alg (5 bits): Encodes the DF election algorithm values (between 0 and 31) that the advertising PE desires to use for the ES. This document creates an IANA registry called \"DF Alg\" (Section 7), which contains the following values:",
      "zh-CHS": "o DF Alg（5位）：对广告PE希望用于ES的DF选择算法值（0到31之间）进行编码。本文档创建了一个名为“DF Alg”的IANA注册表（第7节），其中包含以下值："
    },
    {
      "indent": 6,
      "text": "- Type 0: Default DF election algorithm, or modulus-based algorithm as defined in [RFC7432].",
      "zh-CHS": "- 类型0：默认DF选择算法，或[RFC7432]中定义的基于模的算法。"
    },
    {
      "indent": 6,
      "text": "- Type 1: HRW Algorithm (Section 3).",
      "zh-CHS": "- 类型1：HRW算法（第3节）。"
    },
    {
      "indent": 6,
      "text": "- Types 2-30: Unassigned.",
      "zh-CHS": "- 类型2-30：未分配。"
    },
    {
      "indent": 6,
      "text": "- Type 31: Reserved for Experimental Use.",
      "zh-CHS": "- 31型：保留供实验使用。"
    },
    {
      "indent": 3,
      "text": "o Bitmap (2 octets): Encodes \"capabilities\" to use with the DF election algorithm in the DF Alg field. This document creates an IANA registry (Section 7) for the Bitmap field, with values 0-15. This registry is called \"DF Election Capabilities\" and includes the bit values listed below.",
      "zh-CHS": "o 位图（2个八位字节）：对“能力”进行编码，以便与DF Alg字段中的DF选举算法一起使用。本文档为位图字段创建一个IANA注册表（第7节），其值为0-15。该注册表称为“DF选择功能”，包括下面列出的位值。"
    },
    {
      "indent": 9,
      "text": "                     1 1 1 1 1 1\n 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n| |A|                           |\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+",
      "raw": true,
      "zh-CHS": " "
    },
    {
      "indent": 7,
      "text": "Figure 5: Bitmap Field in the DF Election Extended Community",
      "zh-CHS": "图5:DF选举扩展社区中的位图字段"
    },
    {
      "indent": 6,
      "text": "- Bit 0 (corresponds to Bit 24 of the DF Election Extended Community): Unassigned.",
      "zh-CHS": "- 位0（对应于扩展社区的位24）：未分配。"
    },
    {
      "indent": 6,
      "text": "- Bit 1: AC-DF Capability (AC-Influenced DF election; see Section 4). When set to 1, it indicates the desire to use AC-DF with the rest of the PEs in the ES.",
      "zh-CHS": "- 第1位：交流测向能力（交流影响测向选择；见第4节）。当设置为1时，表示希望将AC-DF与ES中的其余PE一起使用。"
    },
    {
      "indent": 6,
      "text": "- Bits 2-15: Unassigned.",
      "zh-CHS": "- 位2-15：未分配。"
    },
    {
      "indent": 3,
      "text": "The DF Election Extended Community is used as follows:",
      "zh-CHS": "DF选举扩展社区的使用方式如下："
    },
    {
      "indent": 3,
      "text": "o A PE SHOULD attach the DF Election Extended Community to any advertised ES route, and the Extended Community MUST be sent if the ES is locally configured with a DF election algorithm other than the default DF election algorithm or if a capability is required to be used. In the Extended Community, the PE indicates the desired \"DF Alg\" algorithm and \"Bitmap\" capabilities to be used for the ES.",
      "zh-CHS": "o PE应将DF选举扩展社区连接到任何播发的ES路由，如果ES在本地配置了除默认DF选举算法以外的DF选举算法，或者如果需要使用某种功能，则必须发送扩展社区。在扩展社区中，PE表示ES所需的“DF Alg”算法和“位图”功能。"
    },
    {
      "indent": 6,
      "text": "- Only one DF Election Extended Community can be sent along with an ES route. Note that the intent is not for the advertising PE to indicate all the supported DF election algorithms and capabilities but to signal the preferred one.",
      "zh-CHS": "- 只有一个DF选举扩展社区可以与ES路由一起发送。注意，广告PE的目的不是指示所有支持的DF选择算法和功能，而是指示首选算法和功能。"
    },
    {
      "indent": 6,
      "text": "- DF Alg values 0 and 1 can both be used with Bit 1 (AC-DF) set to 0 or 1.",
      "zh-CHS": "- DF Alg值0和1均可在位1（AC-DF）设置为0或1时使用。"
    },
    {
      "indent": 6,
      "text": "- In general, a specific DF Alg SHOULD determine the use of the reserved bits in the Extended Community, which may be used in a different way for a different DF Alg. In particular, for DF Alg values 0 and 1, the reserved bits are not set by the advertising PE and SHOULD be ignored by the receiving PE.",
      "zh-CHS": "- 一般来说，特定的DF-Alg应该确定扩展社区中保留位的使用，对于不同的DF-Alg，保留位可以以不同的方式使用。特别地，对于DF Alg值0和1，保留位不由广告PE设置，并且应由接收PE忽略。"
    },
    {
      "indent": 3,
      "text": "o When a PE receives the ES routes from all the other PEs for the ES in question, it checks to see if all the advertisements have the Extended Community with the same DF Alg and Bitmap:",
      "zh-CHS": "o 当一个PE从所有其他PE接收到有关ES的ES路由时，它会检查所有播发是否具有具有相同DF Alg和位图的扩展社区："
    },
    {
      "indent": 6,
      "text": "- If they do, this particular PE MUST follow the procedures for the advertised DF Alg and capabilities. For instance, if all ES routes for a given ES indicate DF Alg HRW and AC-DF set to 1, then the PEs attached to the ES will perform the DF election as per the HRW algorithm and following the AC-DF procedures.",
      "zh-CHS": "- 如果他们这样做，该特定PE必须遵循公布的DF Alg和能力的程序。例如，如果给定ES的所有ES路由指示DF Alg HRW，且AC-DF设置为1，则连接至ES的PE将根据HRW算法并遵循AC-DF程序执行DF选择。"
    },
    {
      "indent": 6,
      "text": "- Otherwise, if even a single advertisement for Route Type 4 is received without the locally configured DF Alg and capability, the default DF election algorithm MUST be used as prescribed in [RFC7432]. This procedure handles the case where participating PEs in the ES disagree about the DF algorithm and capability to be applied.",
      "zh-CHS": "- 否则，如果在没有本地配置的DF Alg和功能的情况下接收到路由类型4的单个播发，则必须按照[RFC7432]中的规定使用默认的DF选择算法。本程序处理参与ES的PE对DF算法和应用能力不一致的情况。"
    },
    {
      "indent": 6,
      "text": "- The absence of the DF Election Extended Community or the presence of multiple DF Election Extended Communities (in the same route) MUST be interpreted by a receiving PE as an indication of the default DF election algorithm on the sending PE -- that is, DF Alg 0 and no DF election capabilities.",
      "zh-CHS": "- 接收PE必须将不存在DF选举扩展社区或存在多个DF选举扩展社区（在同一路由中）解释为发送PE上默认DF选举算法的指示——即DF Alg 0和无DF选举功能。"
    },
    {
      "indent": 3,
      "text": "o When all the PEs in an ES advertise DF Type 31, they will rely on the local policy to decide how to proceed with the DF election.",
      "zh-CHS": "o 当ES中的所有PE宣传DF类型31时，他们将根据当地政策决定如何进行DF选举。"
    },
    {
      "indent": 3,
      "text": "o For any new capability defined in the future, the applicability/ compatibility of this new capability to/with the existing DF Alg values must be assessed on a case-by-case basis.",
      "zh-CHS": "o 对于未来定义的任何新能力，必须根据具体情况评估该新能力对现有DF Alg值的适用性/兼容性。"
    },
    {
      "indent": 3,
      "text": "o Likewise, for any new DF Alg defined in the future, its applicability/compatibility to/with the existing capabilities must be assessed on a case-by-case basis.",
      "zh-CHS": "o 同样，对于未来定义的任何新DF Alg，其对现有能力的适用性/兼容性必须根据具体情况进行评估。"
    },
    {
      "indent": 0,
      "text": "2.2.1. Backward Compatibility",
      "section_title": true,
      "zh-CHS": "2.2.1. 向后兼容性"
    },
    {
      "indent": 3,
      "text": "Implementations that comply with [RFC7432] only (i.e., implementations that predate this specification) will not advertise the DF Election Extended Community. That means that all other participating PEs in the ES will not receive DF preferences and will revert to the default DF election algorithm without AC-DF.",
      "zh-CHS": "仅符合[RFC7432]的实现（即，早于本规范的实现）不会公布DF选举扩展社区。这意味着ES中所有其他参与的PE将不会收到DF首选项，并将在没有AC-DF的情况下恢复为默认DF选举算法。"
    },
    {
      "indent": 3,
      "text": "Similarly, an implementation that complies with [RFC7432] only and that receives a DF Election Extended Community will ignore it and will continue to use the default DF election algorithm.",
      "zh-CHS": "类似地，仅符合[RFC7432]并接收DF选举扩展社区的实现将忽略它，并将继续使用默认的DF选举算法。"
    },
    {
      "indent": 0,
      "text": "3. The Highest Random Weight DF Election Algorithm",
      "section_title": true,
      "zh-CHS": "3. 最高随机权DF选举算法"
    },
    {
      "indent": 3,
      "text": "The procedure discussed in this section is applicable to the DF election in EVPN services [RFC7432] and the EVPN Virtual Private Wire Service (VPWS) [RFC8214].",
      "zh-CHS": "本节讨论的程序适用于EVPN服务[RFC7432]和EVPN虚拟专用线服务（VPWS）[RFC8214]中的DF选择。"
    },
    {
      "indent": 3,
      "text": "HRW as defined in [HRW1999] is originally proposed in the context of Internet caching and proxy server load balancing. Given an object name and a set of servers, HRW maps a request to a server using the object-name (object-id) and server-name (server-id) rather than the server states. HRW forms a hash out of the server-id and the object-id and forms an ordered list of the servers for the particular object-id. The server for which the hash value is highest serves as the primary server responsible for that particular object, and the server with the next-highest value in that hash serves as the backup server. HRW always maps a given object name to the same server within a given cluster; consequently, it can be used at client sites to achieve global consensus on object-to-server mappings. When that server goes down, the backup server becomes the responsible designate.",
      "zh-CHS": "[HRW1999]中定义的HRW最初是在互联网缓存和代理服务器负载平衡的背景下提出的。给定一个对象名和一组服务器，HRW使用对象名（对象id）和服务器名（服务器id）而不是服务器状态将请求映射到服务器。HRW将服务器id和对象id进行散列，并形成特定对象id的服务器有序列表。散列值最高的服务器用作负责该特定对象的主服务器，散列值次高的服务器用作备份服务器。HRW总是将给定的对象名称映射到给定集群内的同一服务器；因此，它可以在客户端站点上使用，以在对象到服务器的映射上达成全局共识。当该服务器停机时，备份服务器将成为负责的指定服务器。"
    },
    {
      "indent": 3,
      "text": "Choosing an appropriate hash function that is statistically oblivious to the key distribution and imparts a good uniform distribution of the hash output is an important aspect of the algorithm. Fortunately, many such hash functions exist. [HRW1999] provides",
      "zh-CHS": "选择一个适当的哈希函数，该函数在统计上不受密钥分布的影响，并赋予哈希输出良好的均匀分布，这是该算法的一个重要方面。幸运的是，存在许多这样的散列函数。[HRW1999]提供"
    },
    {
      "indent": 3,
      "text": "pseudorandom functions based on the Unix utilities rand and srand and easily constructed XOR functions that satisfy the desired hashing properties. HRW already finds use in multicast and ECMP [RFC2991] [RFC2992].",
      "zh-CHS": "基于Unix实用程序rand和srand的伪随机函数，以及满足所需哈希属性的易于构造的XOR函数。HRW已经在多播和ECMP[RFC2991][RFC2992]中使用。"
    },
    {
      "indent": 0,
      "text": "3.1. HRW and Consistent Hashing",
      "section_title": true,
      "zh-CHS": "3.1. HRW与一致散列"
    },
    {
      "indent": 3,
      "text": "HRW is not the only algorithm that addresses the object-to-server mapping problem with goals of fair load distribution, redundancy, and fast access. There is another family of algorithms that also addresses this problem; these fall under the umbrella of the Consistent Hashing Algorithms [CHASH]. These will not be considered here.",
      "zh-CHS": "HRW并不是解决对象到服务器映射问题的唯一算法，其目标是公平负载分配、冗余和快速访问。还有一系列算法也解决了这个问题；这些都属于一致散列算法[CHASH]的范畴。这里不考虑这些问题。"
    },
    {
      "indent": 0,
      "text": "3.2. HRW Algorithm for EVPN DF Election",
      "section_title": true,
      "zh-CHS": "3.2. EVPN-DF选举的HRW算法"
    },
    {
      "indent": 3,
      "text": "This section describes the application of HRW to DF election. Let DF(V) denote the DF and BDF(V) denote the BDF for the Ethernet Tag V; Si is the IP address of PE i; Es is the ESI; and Weight is a function of V, Si, and Es.",
      "zh-CHS": "本节介绍人权观察在民主阵线选举中的应用。让DF（V）表示DF，BDF（V）表示以太网标签V的BDF；Si是PE i的IP地址；Es是ESI；重量是V，Si和Es的函数。"
    },
    {
      "indent": 3,
      "text": "Note that while the DF election algorithm provided in [RFC7432] uses a PE address and VLAN as inputs, this document uses an Ethernet Tag, PE address, and ESI as inputs. This is because if the same set of PEs are multihomed to the same set of ESes, then the DF election algorithm used in [RFC7432] would result in the same PE being elected DF for the same set of BDs on each ES; this could have adverse side effects on both load balancing and redundancy. Including an ESI in the DF election algorithm introduces additional entropy, which significantly reduces the probability of the same PE being elected DF for the same set of BDs on each ES. Therefore, when using the HRW algorithm for EVPN DF election, the ESI value in the Weight function below SHOULD be set to that of the corresponding ES.",
      "zh-CHS": "注意，[RFC7432]中提供的DF选择算法使用PE地址和VLAN作为输入，而本文档使用以太网标签、PE地址和ESI作为输入。这是因为，如果同一组PE被多址到同一组ESE，那么[RFC7432]中使用的DF选举算法将导致同一PE被选为每个ES上同一组BDs的DF；这可能会对负载平衡和冗余产生不利的副作用。在DF选举算法中包括ESI引入了额外的熵，这显著降低了相同PE在每个ES上为相同BDs集选择DF的概率。因此，当使用HRW算法进行EVPN DF选择时，下面权重函数中的ESI值应设置为相应ES的值。"
    },
    {
      "indent": 3,
      "text": "In the case of a VLAN Bundle service, V denotes the lowest VLAN, similar to the \"lowest VLAN in bundle\" logic of [RFC7432].",
      "zh-CHS": "在VLAN捆绑服务的情况下，V表示最低的VLAN，类似于[RFC7432]的“捆绑中最低的VLAN”逻辑。"
    },
    {
      "indent": 3,
      "text": "1. DF(V) = Si| Weight(V, Es, Si) >= Weight(V, Es, Sj), for all j. In the case of a tie, choose the PE whose IP address is numerically the least. Note that 0 <= i,j < number of PEs in the redundancy group.",
      "zh-CHS": "1. DF（V）=Si |重量（V，Es，Si）>=重量（V，Es，Sj），对于所有j。在平局的情况下，选择IP地址在数字上最少的PE。请注意，0<=i，j<冗余组中的PE数量。"
    },
    {
      "indent": 3,
      "text": "2. BDF(V) = Sk| Weight(V, Es, Si) >= Weight(V, Es, Sk), and Weight(V, Es, Sk) >= Weight(V, Es, Sj). In the case of a tie, choose the PE whose IP address is numerically the least.",
      "zh-CHS": "2. BDF（V）=Sk |权重（V，Es，Si）>=权重（V，Es，Sk），权重（V，Es，Sk）>=权重（V，Es，Sj）。在平局的情况下，选择IP地址在数字上最少的PE。"
    },
    {
      "indent": 3,
      "text": "Where:",
      "zh-CHS": "哪里："
    },
    {
      "indent": 3,
      "text": "o DF(V) is defined to be the address Si (index i) for which Weight(V, Es, Si) is the highest; 0 <= i < N-1.",
      "zh-CHS": "o DF（V）被定义为权重（V，Es，Si）最高的地址Si（索引i）；0<=i<N-1。"
    },
    {
      "indent": 3,
      "text": "o BDF(V) is defined as that PE with address Sk for which the computed Weight is the next highest after the Weight of the DF. j is the running index from 0 to N-1; i and k are selected values.",
      "zh-CHS": "o BDF（V）被定义为地址为Sk的PE，其计算的权重是DF权重之后的下一个最高值。j是从0到N-1的运行指数；i和k是选定的值。"
    },
    {
      "indent": 3,
      "text": "Since the Weight is a pseudorandom function with the domain as the three-tuple (V, Es, S), it is an efficient and deterministic algorithm that is independent of the Ethernet Tag V sample space distribution. Choosing a good hash function for the pseudorandom function is an important consideration for this algorithm to perform better than the default algorithm. As mentioned previously, such functions are described in [HRW1999]. We take as a candidate hash function the first one out of the two that are listed as preferred in [HRW1999]:",
      "zh-CHS": "由于权重是一个伪随机函数，域为三元组（V、Es、S），因此它是一种高效的确定性算法，与以太网标签V样本空间分布无关。为伪随机函数选择一个好的哈希函数是该算法比默认算法性能更好的一个重要考虑因素。如前所述，[HRW1999]中描述了此类功能。我们将[HRW1999]中列出的两个首选哈希函数中的第一个作为候选哈希函数："
    },
    {
      "indent": 6,
      "text": "Wrand(V, Es, Si) = (1103515245((1103515245.Si+12345) XOR\nD(V, Es))+12345)(mod 2^31)",
      "raw": true,
      "zh-CHS": " "
    },
    {
      "indent": 3,
      "text": "Here, D(V, Es) is the 31-bit digest (CRC-32 and discarding the most significant bit (MSB), as noted in [HRW1999]) of the 14-octet stream (the 4-octet Ethernet Tag V followed by the 10-octet ESI). It is mandated that the 14-octet stream be formed by the concatenation of the Ethernet Tag and the ESI in network byte order. The CRC should proceed as if the stream is in network byte order (big-endian). Si is the address of the ith server. The server's IP address length does not matter, as only the low-order 31 bits are modulo significant.",
      "zh-CHS": "这里，D（V，Es）是14个八位字节流（4个八位字节的以太网标记V后跟10个八位字节的ESI）的31位摘要（CRC-32并丢弃最高有效位（MSB），如[HRW1999]中所述）。要求14个八位字节流由以太网标签和ESI按网络字节顺序串联而成。CRC应该按照网络字节顺序（big-endian）处理流。Si是第i台服务器的地址。服务器的IP地址长度无关紧要，因为只有低阶31位是模有效的。"
    },
    {
      "indent": 3,
      "text": "A point to note is that the Weight function takes into consideration the combination of the Ethernet Tag, the ES, and the PE IP address, and the actual length of the server IP address (whether IPv4 or IPv6) is not really relevant. The default algorithm defined in [RFC7432] cannot employ both IPv4 and IPv6 PE addresses, since [RFC7432] does not specify how to decide on the ordering (the ordinal list) when both IPv4 and IPv6 PEs are present.",
      "zh-CHS": "需要注意的一点是，权重函数考虑了以太网标签、ES和PE IP地址的组合，而服务器IP地址的实际长度（无论是IPv4还是IPv6）实际上并不相关。[RFC7432]中定义的默认算法不能同时使用IPv4和IPv6 PE地址，因为[RFC7432]没有指定在IPv4和IPv6 PE同时存在时如何决定顺序（顺序列表）。"
    },
    {
      "indent": 3,
      "text": "HRW solves the disadvantages pointed out in Section 1.3.1 of this document and ensures that:",
      "zh-CHS": "HRW解决了本文件第1.3.1节中指出的缺点，并确保："
    },
    {
      "indent": 3,
      "text": "o With very high probability, the task of DF election for the VLANs configured on an ES is more or less equally distributed among the PEs, even in the case of two PEs (see the first fundamental problem listed in Section 1.3.1).",
      "zh-CHS": "o 即使在两个PE的情况下，ES上配置的VLAN的DF选择任务在各PE之间也或多或少地平均分布（参见第1.3.1节中列出的第一个基本问题）。"
    },
    {
      "indent": 3,
      "text": "o If a PE that is not the DF or the BDF for that VLAN goes down or its connection to the ES goes down, it does not result in a DF or BDF reassignment. This saves computation, especially in the case when the connection flaps.",
      "zh-CHS": "o 如果不是该VLAN的DF或BDF的PE发生故障或其与ES的连接发生故障，则不会导致DF或BDF重新分配。这节省了计算，尤其是在连接襟翼的情况下。"
    },
    {
      "indent": 3,
      "text": "o More importantly, it avoids the third fundamental problem listed in Section 1.3.1 (needless disruption) that is inherent in the existing default DF election.",
      "zh-CHS": "o 更重要的是，它避免了第1.3.1节（不必要的中断）中列出的第三个基本问题，这是现有默认DF选举中固有的问题。"
    },
    {
      "indent": 3,
      "text": "o In addition to the DF, the algorithm also furnishes the BDF, which would be the DF if the current DF fails.",
      "zh-CHS": "o 除了DF之外，该算法还提供BDF，如果当前DF失败，BDF就是DF。"
    },
    {
      "indent": 0,
      "text": "4. The AC-Influenced DF Election Capability",
      "section_title": true,
      "zh-CHS": "4. 交流影响DF选择能力"
    },
    {
      "indent": 3,
      "text": "The procedure discussed in this section is applicable to the DF election in EVPN services [RFC7432] and EVPN VPWS [RFC8214].",
      "zh-CHS": "本节讨论的程序适用于EVPN服务[RFC7432]和EVPN VPWS[RFC8214]中的DF选择。"
    },
    {
      "indent": 3,
      "text": "The AC-DF capability is expected to be generally applicable to any future DF algorithm. It modifies the DF election procedures by removing from consideration any candidate PE in the ES that cannot forward traffic on the AC that belongs to the BD. This section is applicable to VLAN-based and VLAN Bundle service interfaces. Section 4.1 describes the procedures for VLAN-aware Bundle service interfaces.",
      "zh-CHS": "AC-DF能力一般适用于未来的任何DF算法。它通过删除ES中不能转发属于BD的AC上流量的任何候选PE来修改DF选择过程。本节适用于基于VLAN和VLAN捆绑服务接口。第4.1节描述了支持VLAN的捆绑服务接口的过程。"
    },
    {
      "indent": 3,
      "text": "In particular, when used with the default DF algorithm, the AC-DF capability modifies Step 3 in the DF election procedure described in [RFC7432], Section 8.5, as follows:",
      "zh-CHS": "特别是，当与默认测向算法一起使用时，AC-DF能力修改[RFC7432]第8.5节中所述测向选择程序的步骤3，如下所示："
    },
    {
      "indent": 3,
      "text": "3. When the timer expires, each PE builds an ordered candidate list of the IP addresses of all the PE nodes attached to the ES (including itself), in increasing numeric value. The candidate list is based on the Originating Router's IP addresses of the ES routes but excludes any PE from whom no Ethernet A-D per ES route has been received or from whom the route has been withdrawn. Afterwards, the DF election algorithm is applied on a per <ES, Ethernet Tag>; however, the IP address for a PE will not be considered to be a candidate for a given <ES, Ethernet Tag> until the corresponding Ethernet A-D per EVI route has been received from that PE. In other words, the ACS on the ES for a given PE must be UP so that the PE is considered to be a candidate for a given BD.",
      "zh-CHS": "3. 当计时器过期时，每个PE以递增的数值构建连接到ES（包括其自身）的所有PE节点的IP地址的有序候选列表。候选列表基于ES路由的原始路由器IP地址，但不包括每个ES路由未接收到以太网A-D或路由已从其撤回的任何PE。然后，在per<ES，Ethernet Tag>上应用DF选择算法；然而，在从给定的<ES，Ethernet Tag>PE接收到每个EVI路由对应的以太网a-D之前，PE的IP地址将不会被视为该PE的候选地址。换句话说，给定PE的ES上的ACS必须向上，以便PE被视为给定BD的候选。"
    },
    {
      "indent": 6,
      "text": "If the default DF algorithm is used, every PE in the resulting candidate list is then given an ordinal indicating its position in the ordered list, starting with 0 as the ordinal for the PE with",
      "zh-CHS": "如果使用默认的DF算法，则生成的候选列表中的每个PE都会得到一个序号，指示其在有序列表中的位置，从0开始作为带有"
    },
    {
      "indent": 6,
      "text": "the numerically lowest IP address. The ordinals are used to determine which PE node will be the DF for a given Ethernet Tag on the ES, using the following rule:",
      "zh-CHS": "数字最低的IP地址。序号用于使用以下规则确定哪个PE节点将是ES上给定以太网标签的DF："
    },
    {
      "indent": 6,
      "text": "Assuming a redundancy group of N PE nodes, for VLAN-based service, the PE with ordinal i is the DF for an <ES, Ethernet Tag V> when (V mod N) = i. In the case of a VLAN (-aware) Bundle service, then the numerically lowest VLAN value in that bundle on that ES MUST be used in the modulo function as the Ethernet Tag.",
      "zh-CHS": "假设N个PE节点的冗余组，对于基于VLAN的服务，序号为i的PE是（V mod N）=i时<ES，以太网标签V>的DF。如果是VLAN（-aware）捆绑服务，则必须在模函数中使用该ES上该捆绑中数字最低的VLAN值作为以太网标记。"
    },
    {
      "indent": 6,
      "text": "It should be noted that using the Originating Router's IP Address field [RFC7432] in the ES route to get the PE IP address needed for the ordered list allows for a CE to be multihomed across different Autonomous Systems (ASes) if such a need ever arises.",
      "zh-CHS": "应该注意的是，在ES路由中使用始发路由器的IP地址字段[RFC7432]来获取有序列表所需的PE IP地址允许CE在不同的自治系统（ASE）之间进行多宿（如果需要）。"
    },
    {
      "indent": 3,
      "text": "The modified Step 3, above, differs from [RFC7432], Section 8.5, Step 3 in two ways:",
      "zh-CHS": "上述修改后的第3步与[RFC7432]第8.5节第3步有两个不同之处："
    },
    {
      "indent": 3,
      "text": "o Any DF Alg can be used -- not only the described modulus-based DF Alg (referred to as the default DF election or \"DF Alg 0\" in this document).",
      "zh-CHS": "o 可以使用任何DF Alg，而不仅仅是描述的基于模数的DF Alg（在本文档中称为默认DF选择或“DF Alg 0”）。"
    },
    {
      "indent": 3,
      "text": "o The candidate list is pruned based upon non-receipt of Ethernet A-D routes: a PE's IP address MUST be removed from the ES candidate list if its Ethernet A-D per ES route is withdrawn. A PE's IP address MUST NOT be considered to be a candidate DF for an <ES, Ethernet Tag> if its Ethernet A-D per EVI route for the <ES, Ethernet Tag> is withdrawn.",
      "zh-CHS": "o 候选列表根据未收到以太网A-D路由进行修剪：如果每个ES路由的以太网A-D被撤销，则必须从ES候选列表中删除PE的IP地址。如果每个<ES，Ethernet Tag>的每个EVI路由的以太网A-D被撤销，则PE的IP地址不得被视为<ES，Ethernet Tag>的候选DF。"
    },
    {
      "indent": 3,
      "text": "The following example illustrates the AC-DF behavior applied to the default DF election algorithm, assuming the network in Figure 2:",
      "zh-CHS": "以下示例说明了应用于默认DF选举算法的AC-DF行为，假设网络如图2所示："
    },
    {
      "indent": 3,
      "text": "(a) When PE1 and PE2 discover ES12, they advertise an ES route for ES12 with the associated ES-Import Extended Community and the DF Election Extended Community indicating AC-DF = 1; they start a DF Wait timer (independently). Likewise, PE2 and PE3 advertise an ES route for ES23 with AC-DF = 1 and start a DF Wait timer.",
      "zh-CHS": "(a) 当PE1和PE2发现ES12时，它们为ES12播发ES路由，关联的ES导入扩展社区和DF选举扩展社区指示AC-DF=1；它们（独立）启动DF等待计时器。同样，PE2和PE3为AC-DF=1的ES23播发ES路由，并启动DF等待计时器。"
    },
    {
      "indent": 3,
      "text": "(b) PE1 and PE2 advertise an Ethernet A-D per ES route for ES12. PE2 and PE3 advertise an Ethernet A-D per ES route for ES23.",
      "zh-CHS": "(b) PE1和PE2根据ES12的ES路由发布以太网A-D。PE2和PE3根据ES23的ES路由宣传以太网A-D。"
    },
    {
      "indent": 3,
      "text": "(c) In addition, PE1, PE2, and PE3 advertise an Ethernet A-D per EVI route for AC1, AC2, AC3, and AC4 as soon as the ACs are enabled. Note that the AC can be associated with a single customer VID (e.g., VLAN-based service interfaces) or a bundle of customer VIDs (e.g., VLAN Bundle service interfaces).",
      "zh-CHS": "(c) 此外，一旦启用ACs，PE1、PE2和PE3将根据AC1、AC2、AC3和AC4的EVI路由发布以太网A-D。注意，AC可以与单个客户VID（例如，基于VLAN的服务接口）或客户VID包（例如，VLAN包服务接口）相关联。"
    },
    {
      "indent": 3,
      "text": "(d) When the timer expires, each PE builds an ordered candidate list of the IP addresses of all the PE nodes attached to the ES (including itself) as explained in the modified Step 3 above. Any PE from which an Ethernet A-D per ES route has not been received is pruned from the list.",
      "zh-CHS": "(d) 当计时器过期时，每个PE构建连接到ES（包括其自身）的所有PE节点的IP地址的有序候选列表，如上面修改的步骤3中所述。从列表中删除所有未接收到以太网A-D per ES路由的PE。"
    },
    {
      "indent": 3,
      "text": "(e) When electing the DF for a given BD, a PE will not be considered to be a candidate until an Ethernet A-D per EVI route has been received from that PE. In other words, the ACS on the ES for a given PE must be UP so that the PE is considered to be a candidate for a given BD. For example, PE1 will not consider PE2 as a candidate for DF election for <ES12, VLAN-1> until an Ethernet A-D per EVI route is received from PE2 for <ES12, VLAN-1>.",
      "zh-CHS": "(e) 当为给定BD选择DF时，PE将不被视为候选，直到从该PE收到每个EVI路由的以太网a-D。换言之，对于给定的PE，ES上的ACS必须被提升，使得PE被认为是给定BD的候选。例如，PE1将不考虑PE2作为对ES12、VLAN-1的DF选举的候选，直到从E2接收Ethernet Ad EVI路由到ES12、VLAN-1 >。"
    },
    {
      "indent": 3,
      "text": "(f) Once the PEs with ACS = DOWN for a given BD have been removed from the candidate list, the DF election can be applied for the remaining N candidates.",
      "zh-CHS": "(f) 一旦给定BD的ACS=DOWN的PEs已从候选人列表中删除，则可对其余N名候选人应用DF选举。"
    },
    {
      "indent": 3,
      "text": "Note that this procedure only modifies the existing EVPN control plane by adding and processing the DF Election Extended Community and by pruning the candidate list of PEs that take part in the DF election.",
      "zh-CHS": "请注意，此过程仅通过添加和处理DF选举扩展社区以及修剪参与DF选举的PE候选列表来修改现有EVPN控制平面。"
    },
    {
      "indent": 3,
      "text": "In addition to the events defined in the FSM in Section 2.1, the following events SHALL modify the candidate PE list and trigger the DF re-election in a PE for a given <ES, Ethernet Tag>. In the FSM shown in Figure 3, the events below MUST trigger a transition from DF_DONE to DF_CALC:",
      "zh-CHS": "除第2.1节中FSM中定义的事件外，以下事件应修改候选PE列表，并触发PE中给定<ES，Ethernet Tag>的DF重新选择。在图3所示的FSM中，以下事件必须触发从DF_DONE到DF_CALC的转换："
    },
    {
      "indent": 3,
      "text": "1. Local AC going DOWN/UP.",
      "zh-CHS": "1. 本地交流电压下降/上升。"
    },
    {
      "indent": 3,
      "text": "2. Reception of a new Ethernet A-D per EVI route update/withdrawal for the <ES, Ethernet Tag>.",
      "zh-CHS": "2. 根据EVI路线更新/撤销，为<ES，Ethernet Tag>接收新的以太网a-D。"
    },
    {
      "indent": 3,
      "text": "3. Reception of a new Ethernet A-D per ES route update/withdrawal for the ES.",
      "zh-CHS": "3. 根据ES的ES路线更新/撤销接收新的以太网a-D。"
    },
    {
      "indent": 0,
      "text": "4.1. AC-Influenced DF Election Capability for VLAN-Aware Bundle Services",
      "zh-CHS": "4.1. 支持VLAN的捆绑服务的AC影响DF选择能力"
    },
    {
      "indent": 3,
      "text": "The procedure described in Section 4 works for VLAN-based and VLAN Bundle service interfaces because, for those service types, a PE advertises only one Ethernet A-D per EVI route per <ES, VLAN> or <ES, VLAN Bundle>. In Section 4, an Ethernet Tag represents a given VLAN or VLAN Bundle for the purpose of DF election. The withdrawal",
      "zh-CHS": "第4节中描述的过程适用于基于VLAN和VLAN捆绑服务接口，因为对于这些服务类型，PE在每个<ES，VLAN>或<ES，VLAN捆绑>的每个EVI路由上仅播发一个以太网a-D。在第4节中，Ethernet标记表示一个给定的VLAN或VLAN包，用于DF选择。撤回"
    },
    {
      "indent": 3,
      "text": "of such a route means that the PE cannot forward traffic on that particular <ES, VLAN> or <ES, VLAN Bundle>; therefore, the PE can be removed from consideration for DF election.",
      "zh-CHS": "这种路由的延迟意味着PE不能转发该特定<ES，VLAN>或<ES，VLAN Bundle>上的流量；因此，PE可以从DF选举的考虑中删除。"
    },
    {
      "indent": 3,
      "text": "According to [RFC7432], in VLAN-aware Bundle services, the PE advertises multiple Ethernet A-D per EVI routes per <ES, VLAN Bundle> (one route per Ethernet Tag), while the DF election is still performed per <ES, VLAN Bundle>. The withdrawal of an individual route only indicates the unavailability of a specific AC and not necessarily all the ACs in the <ES, VLAN Bundle>.",
      "zh-CHS": "根据[RFC7432]，在支持VLAN的捆绑服务中，PE在每个<ES，VLAN捆绑>（每个以太网标签一条路由）的每个EVI路由中播发多个以太网A-D，而DF选择仍在每个<ES，VLAN捆绑>。撤回单个路由仅表示特定AC不可用，而不一定表示<ES，VLAN捆绑包>中的所有AC不可用。"
    },
    {
      "indent": 3,
      "text": "This document modifies the DF election for VLAN-aware Bundle services in the following ways:",
      "zh-CHS": "本文档通过以下方式修改VLAN感知捆绑服务的DF选择："
    },
    {
      "indent": 3,
      "text": "o After confirming that all the PEs in the ES advertise the AC-DF capability, a PE will perform a DF election per <ES, VLAN>, as opposed to per <ES, VLAN Bundle> as described in [RFC7432]. Now, the withdrawal of an Ethernet A-D per EVI route for a VLAN will indicate that the advertising PE's ACS is DOWN and the rest of the PEs in the ES can remove the PE from consideration for DF election in the <ES, VLAN>.",
      "zh-CHS": "o 在确认ES中的所有PE宣传AC-DF能力后，PE将根据<ES，VLAN>执行DF选择，而不是[RFC7432]中所述的每<ES，VLAN束>。现在，撤销VLAN的每个EVI路由的以太网A-D将表明广告PE的ACS已关闭，ES中的其余PE可以将PE从<ES，VLAN>中的DF选择考虑中删除。"
    },
    {
      "indent": 3,
      "text": "o The PEs will now follow the procedures in Section 4.",
      "zh-CHS": "o PEs现在将遵循第4节中的程序。"
    },
    {
      "indent": 3,
      "text": "For example, assuming three bridge tables in PE1 for the same MAC-VRF (each one associated with a different Ethernet Tag, e.g., VLAN-1, VLAN-2, and VLAN-3), PE1 will advertise three Ethernet A-D per EVI routes for ES12. Each of the three routes will indicate the status of each of the three ACs in ES12. PE1 will be considered to be a valid candidate PE for DF election in <ES12, VLAN-1>, <ES12, VLAN-2>, and <ES12, VLAN-3> as long as its three routes are active. For instance, if PE1 withdraws the Ethernet A-D per EVI routes for <ES12, VLAN-1>, the PEs in ES12 will not consider PE1 as a suitable DF candidate for <ES12, VLAN-1>. PE1 will still be considered for <ES12, VLAN-2> and <ES12, VLAN-3>, since its routes are active.",
      "zh-CHS": "例如，假设PE1中的三个网桥表用于相同的MAC-VRF（每个网桥表与不同的以太网标签关联，例如VLAN-1、VLAN-2和VLAN-3），PE1将为ES12的每个EVI路由播发三个以太网a-D。三条路线中的每一条都将指示ES12中三个ACs的状态。PE1将被视为<ES12，VLAN-1>、<ES12，VLAN-2>和<ES12，VLAN-3>中DF选举的有效候选PE，只要其三条路由处于活动状态。例如，如果PE1退出EVI路由的EAS12，VLAN-1＞，ES12中的PES将不考虑PE1作为适合ES12、VLAN-1＞的DF候选。PE1仍将被考虑用于<ES12，VLAN-2>和<ES12，VLAN-3>，因为其路由是活动的。"
    },
    {
      "indent": 0,
      "text": "5. Solution Benefits",
      "section_title": true,
      "zh-CHS": "5. 解决方案好处"
    },
    {
      "indent": 3,
      "text": "The solution described in this document provides the following benefits:",
      "zh-CHS": "本文档中描述的解决方案具有以下优点："
    },
    {
      "indent": 3,
      "text": "(a) It extends the DF election as defined in [RFC7432] to address the unfair load balancing and potential black-holing issues with the default DF election algorithm. The solution is applicable to the DF election in EVPN services [RFC7432] and EVPN VPWS [RFC8214].",
      "zh-CHS": "(a) 它扩展了[RFC7432]中定义的DF选择，以解决默认DF选择算法的不公平负载平衡和潜在的黑洞问题。该解决方案适用于EVPN业务[RFC7432]和EVPN VPWS[RFC8214]中的DF选择。"
    },
    {
      "indent": 3,
      "text": "(b) It defines a way to signal the DF election algorithm and capabilities intended by the advertising PE. This is done by defining the DF Election Extended Community, which allows the advertising PE to indicate its support for the capabilities defined in this document as well as any subsequently defined DF election algorithms or capabilities.",
      "zh-CHS": "(b) 它定义了一种方法，用于向广告PE预期的DF选举算法和功能发送信号。这是通过定义DF选举扩展社区来实现的，该社区允许广告PE表明其对本文档中定义的功能以及任何随后定义的DF选举算法或功能的支持。"
    },
    {
      "indent": 3,
      "text": "(c) It is backwards compatible with the procedures defined in [RFC7432]. If one or more PEs in the ES do not support the new procedures, they will all follow DF election as defined in [RFC7432].",
      "zh-CHS": "(c) 它与[RFC7432]中定义的过程向后兼容。如果ES中的一个或多个PE不支持新程序，则它们都将遵循[RFC7432]中定义的DF选举。"
    },
    {
      "indent": 0,
      "text": "6. Security Considerations",
      "section_title": true,
      "zh-CHS": "6. 安全考虑"
    },
    {
      "indent": 3,
      "text": "This document addresses some identified issues in the DF election procedures described in [RFC7432] by defining a new DF election framework. In general, this framework allows the PEs that are part of the same ES to exchange additional information and agree on the DF election type and capabilities to be used.",
      "zh-CHS": "本文件通过定义新的DF选举框架，解决了[RFC7432]中描述的DF选举程序中的一些已识别问题。一般来说，该框架允许属于同一ES的PE交换额外信息，并就要使用的DF选举类型和能力达成一致。"
    },
    {
      "indent": 3,
      "text": "By following the procedures in this document, the operator will minimize such undesirable situations as unfair load balancing, service disruption, and traffic black-holing. Because such situations could be purposely created by a malicious user with access to the configuration of one PE, this document also enhances the security of the network. Note that the network will not benefit from the new procedures if the DF election algorithm is not consistently configured on all the PEs in the ES (if there is no unanimity among all the PEs, the DF election algorithm falls back to the default DF election as provided in [RFC7432]). This behavior could be exploited by an attacker that manages to modify the configuration of one PE in the ES so that the DF election algorithm and capabilities in all the PEs in the ES fall back to the default DF election. If that is the case, the PEs will be exposed to the unfair load balancing, service disruption, and black-holing mentioned earlier.",
      "zh-CHS": "通过遵循本文件中的程序，运营商将尽量减少不公平的负载平衡、服务中断和交通堵塞等不良情况。由于这种情况可能是恶意用户通过访问一个PE的配置故意造成的，因此本文档还增强了网络的安全性。请注意，如果在ES中的所有PE上没有一致地配置DF选举算法，则网络将不会受益于新程序（如果所有PE之间没有一致性，DF选举算法将退回到[RFC7432]中提供的默认DF选举）。攻击者可利用此行为修改ES中一个PE的配置，从而使ES中所有PE中的DF选择算法和功能返回默认DF选择。如果是这样，PEs将面临前面提到的不公平的负载平衡、服务中断和黑洞。"
    },
    {
      "indent": 3,
      "text": "In addition, the new framework is extensible and allows for new security enhancements in the future. Note that such enhancements are out of scope for this document. Finally, since this document extends the procedures in [RFC7432], the same security considerations as those described in [RFC7432] are valid for this document.",
      "zh-CHS": "此外，新框架是可扩展的，并允许将来进行新的安全增强。请注意，此类增强超出了本文档的范围。最后，由于本文档扩展了[RFC7432]中的过程，因此与[RFC7432]中所述的安全注意事项同样适用于本文档。"
    },
    {
      "indent": 0,
      "text": "7. IANA Considerations",
      "section_title": true,
      "zh-CHS": "7. IANA考虑"
    },
    {
      "indent": 3,
      "text": "IANA has:",
      "zh-CHS": "IANA有："
    },
    {
      "indent": 3,
      "text": "o Allocated Sub-Type value 0x06 in the \"EVPN Extended Community Sub-Types\" registry defined in [RFC7153] as follows:",
      "zh-CHS": "o [RFC7153]中定义的“EVPN扩展社区子类型”注册表中的分配子类型值0x06如下："
    },
    {
      "indent": 6,
      "text": "Sub-Type Value    Name                             Reference\n--------------    ------------------------------   -------------\n0x06              DF Election Extended Community   This document",
      "raw": true,
      "zh-CHS": " "
    },
    {
      "indent": 3,
      "text": "o Set up a registry called \"DF Alg\" for the DF Alg field in the Extended Community. New registrations will be made through the \"RFC Required\" procedure defined in [RFC8126]. Value 31 is for experimental use and does not require any other RFC than this document. The following initial values in that registry exist:",
      "zh-CHS": "o 为扩展社区中的DF Alg字段设置一个名为“DF Alg”的注册表。新的注册将通过[RFC8126]中定义的“需要RFC”程序进行。值31仅供实验使用，不需要本文件以外的任何其他RFC。该注册表中存在以下初始值："
    },
    {
      "indent": 6,
      "text": "Alg         Name                               Reference\n----        -----------------------------      -------------\n0           Default DF Election                This document\n1           HRW Algorithm                      This document\n2-30        Unassigned\n31          Reserved for Experimental Use      This document",
      "raw": true,
      "zh-CHS": " "
    },
    {
      "indent": 3,
      "text": "o Set up a registry called \"DF Election Capabilities\" for the 2-octet Bitmap field in the Extended Community. New registrations will be made through the \"RFC Required\" procedure defined in [RFC8126]. The following initial value in that registry exists:",
      "zh-CHS": "o 为扩展社区中的2-octet位图字段设置一个名为“DF Election Capabilities”的注册表。新的注册将通过[RFC8126]中定义的“需要RFC”程序进行。该注册表中存在以下初始值："
    },
    {
      "indent": 6,
      "text": "Bit         Name                             Reference\n----        ----------------                 -------------\n0           Unassigned\n1           AC-DF Capability                 This document\n2-15        Unassigned",
      "raw": true,
      "zh-CHS": " "
    },
    {
      "indent": 0,
      "text": "8. References",
      "section_title": true,
      "zh-CHS": "8. 工具书类"
    },
    {
      "indent": 0,
      "text": "8.1. Normative References",
      "section_title": true,
      "zh-CHS": "8.1. 规范性引用文件"
    },
    {
      "indent": 3,
      "text": "[RFC7432] Sajassi, A., Ed., Aggarwal, R., Bitar, N., Isaac, A., Uttaro, J., Drake, J., and W. Henderickx, \"BGP MPLS-Based Ethernet VPN\", RFC 7432, DOI 10.17487/RFC7432, February 2015, <https://www.rfc-editor.org/info/rfc7432>.",
      "zh-CHS": "[RFC7432]Sajassi，A.，Ed.，Aggarwal，R.，Bitar，N.，Isaac，A.，Uttaro，J.，Drake，J.，和W.Henderickx，“基于BGP MPLS的以太网VPN”，RFC 7432，DOI 10.17487/RFC7432，2015年2月<https://www.rfc-editor.org/info/rfc7432>."
    },
    {
      "indent": 3,
      "text": "[RFC8214] Boutros, S., Sajassi, A., Salam, S., Drake, J., and J. Rabadan, \"Virtual Private Wire Service Support in Ethernet VPN\", RFC 8214, DOI 10.17487/RFC8214, August 2017, <https://www.rfc-editor.org/info/rfc8214>.",
      "zh-CHS": "[RFC8214]Boutros，S.，Sajassi，A.，Salam，S.，Drake，J.，和J.Rabadan，“以太网VPN中的虚拟专用线服务支持”，RFC 8214，DOI 10.17487/RFC8214，2017年8月<https://www.rfc-editor.org/info/rfc8214>."
    },
    {
      "indent": 3,
      "text": "[RFC2119] Bradner, S., \"Key words for use in RFCs to Indicate Requirement Levels\", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997, <https://www.rfc-editor.org/info/rfc2119>.",
      "zh-CHS": "[RFC2119]Bradner，S.，“RFC中用于表示需求水平的关键词”，BCP 14，RFC 2119，DOI 10.17487/RFC2119，1997年3月<https://www.rfc-editor.org/info/rfc2119>."
    },
    {
      "indent": 3,
      "text": "[RFC8174] Leiba, B., \"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words\", BCP 14, RFC 8174, DOI 10.17487/RFC8174, May 2017, <https://www.rfc-editor.org/info/rfc8174>.",
      "zh-CHS": "[RFC8174]Leiba，B.，“RFC 2119关键词中大写与小写的歧义”，BCP 14，RFC 8174，DOI 10.17487/RFC8174，2017年5月<https://www.rfc-editor.org/info/rfc8174>."
    },
    {
      "indent": 3,
      "text": "[RFC4360] Sangli, S., Tappan, D., and Y. Rekhter, \"BGP Extended Communities Attribute\", RFC 4360, DOI 10.17487/RFC4360, February 2006, <https://www.rfc-editor.org/info/rfc4360>.",
      "zh-CHS": "[RFC4360]Sangli，S.，Tappan，D.和Y.Rekhter，“BGP扩展社区属性”，RFC 4360，DOI 10.17487/RFC4360，2006年2月<https://www.rfc-editor.org/info/rfc4360>."
    },
    {
      "indent": 3,
      "text": "[RFC7153] Rosen, E. and Y. Rekhter, \"IANA Registries for BGP Extended Communities\", RFC 7153, DOI 10.17487/RFC7153, March 2014, <https://www.rfc-editor.org/info/rfc7153>.",
      "zh-CHS": "[RFC7153]Rosen，E.和Y.Rekhter，“BGP扩展社区的IANA注册”，RFC 7153，DOI 10.17487/RFC7153，2014年3月<https://www.rfc-editor.org/info/rfc7153>."
    },
    {
      "indent": 3,
      "text": "[RFC8126] Cotton, M., Leiba, B., and T. Narten, \"Guidelines for Writing an IANA Considerations Section in RFCs\", BCP 26, RFC 8126, DOI 10.17487/RFC8126, June 2017, <https://www.rfc-editor.org/info/rfc8126>.",
      "zh-CHS": "[RFC8126]Cotton，M.，Leiba，B.，和T.Narten，“在RFC中编写IANA考虑事项部分的指南”，BCP 26，RFC 8126，DOI 10.17487/RFC8126，2017年6月<https://www.rfc-editor.org/info/rfc8126>."
    },
    {
      "indent": 0,
      "text": "8.2. Informative References",
      "section_title": true,
      "zh-CHS": "8.2. 资料性引用"
    },
    {
      "indent": 3,
      "text": "[VPLS-MH] Kothari, B., Kompella, K., Henderickx, W., Balus, F., and J. Uttaro, \"BGP based Multi-homing in Virtual Private LAN Service\", Work in Progress, draft-ietf-bess-vpls-multihoming-03, March 2019.",
      "zh-CHS": "[VPLS-MH]Kothari，B.，Kompella，K.，Henderickx，W.，Balus，F.，和J.Uttaro，“虚拟专用局域网服务中基于BGP的多主服务”，正在进行的工作，草案-ietf-bess-VPLS-multihoming-032019年3月。"
    },
    {
      "indent": 3,
      "text": "[CHASH] Karger, D., Lehman, E., Leighton, T., Panigrahy, R., Levine, M., and D. Lewin, \"Consistent Hashing and Random Trees: Distributed Caching Protocols for Relieving Hot Spots on the World Wide Web\", ACM Symposium on Theory of Computing, ACM Press, New York, DOI 10.1145/258533.258660, May 1997.",
      "zh-CHS": "[CHASH]Karger，D.，Lehman，E.，Leighton，T.，Panigrahy，R.，Levine，M.，和D.Lewin，“一致散列和随机树：缓解万维网上热点的分布式缓存协议”，ACM计算理论研讨会，ACM出版社，纽约，DOI 10.1145/258533.258660，1997年5月。"
    },
    {
      "indent": 3,
      "text": "[CLRS2009] Cormen, T., Leiserson, C., Rivest, R., and C. Stein, \"Introduction to Algorithms (3rd Edition)\", MIT Press, ISBN 0-262-03384-8, 2009.",
      "zh-CHS": "[CLRS2009]Cormen，T.，Leiserson，C.，Rivest，R.，和C.Stein，“算法简介（第三版）”，麻省理工学院出版社，ISBN 0-262-03384-82009。"
    },
    {
      "indent": 3,
      "text": "[RFC2991] Thaler, D. and C. Hopps, \"Multipath Issues in Unicast and Multicast Next-Hop Selection\", RFC 2991, DOI 10.17487/RFC2991, November 2000, <https://www.rfc-editor.org/info/rfc2991>.",
      "zh-CHS": "[RFC2991]Thaler，D.和C.Hopps，“单播和多播下一跳选择中的多路径问题”，RFC 2991，DOI 10.17487/RFC2991，2000年11月<https://www.rfc-editor.org/info/rfc2991>."
    },
    {
      "indent": 3,
      "text": "[RFC2992] Hopps, C., \"Analysis of an Equal-Cost Multi-Path Algorithm\", RFC 2992, DOI 10.17487/RFC2992, November 2000, <https://www.rfc-editor.org/info/rfc2992>.",
      "zh-CHS": "[RFC2992]Hopps，C.，“等成本多路径算法的分析”，RFC 2992，DOI 10.17487/RFC2992，2000年11月<https://www.rfc-editor.org/info/rfc2992>."
    },
    {
      "indent": 3,
      "text": "[RFC4456] Bates, T., Chen, E., and R. Chandra, \"BGP Route Reflection: An Alternative to Full Mesh Internal BGP (IBGP)\", RFC 4456, DOI 10.17487/RFC4456, April 2006, <https://www.rfc-editor.org/info/rfc4456>.",
      "zh-CHS": "[RFC4456]Bates，T.，Chen，E.和R.Chandra，“BGP路由反射：全网格内部BGP（IBGP）的替代方案”，RFC 4456，DOI 10.17487/RFC4456，2006年4月<https://www.rfc-editor.org/info/rfc4456>."
    },
    {
      "indent": 3,
      "text": "[HRW1999] Thaler, D. and C. Ravishankar, \"Using Name-Based Mappings to Increase Hit Rates\", IEEE/ACM Transactions on Networking, Volume 6, No. 1, February 1998, <https://www.microsoft.com/en-us/research/wp-content/ uploads/2017/02/HRW98.pdf>.",
      "zh-CHS": "[HRW1999]Thaler，D.和C.Ravishankar，“使用基于名称的映射来提高命中率”，IEEE/ACM网络交易，第6卷，第1期，1998年2月<https://www.microsoft.com/en-us/research/wp-content/ 上传/2017/02/HRW98.pdf>。"
    },
    {
      "indent": 3,
      "text": "[Knuth] Knuth, D., \"The Art of Computer Programming: Volume 3: Sorting and Searching\", 2nd Edition, Addison-Wesley, Page 516, 1998.",
      "zh-CHS": "[Knuth]Knuth，D.，“计算机编程的艺术：第3卷：排序和搜索”，第2版，Addison-Wesley，第516页，1998年。"
    },
    {
      "indent": 0,
      "text": "Acknowledgments",
      "zh-CHS": "致谢"
    },
    {
      "indent": 3,
      "text": "The authors want to thank Ranganathan Boovaraghavan, Sami Boutros, Luc Andre Burdet, Anoop Ghanwani, Mrinmoy Ghosh, Jakob Heitz, Leo Mermelstein, Mankamana Mishra, Tamas Mondal, Laxmi Padakanti, Samir Thoria, and Sriram Venkateswaran for their review and contributions. Special thanks to Stephane Litkowski for his thorough review and detailed contributions.",
      "zh-CHS": "作者要感谢兰加纳坦·布瓦拉哈万、萨米·布特罗斯、吕克·安德烈·伯代特、阿努普·加瓦尼、姆林莫伊·戈什、雅各布·海茨、利奥·梅尔梅尔斯坦、曼卡马纳·米什拉、塔马斯·蒙达尔、拉克米·帕达坎蒂、萨米尔·托里亚和斯里拉姆·文卡特斯瓦兰的评论和贡献。特别感谢Stephane Litkowski的全面审查和详细贡献。"
    },
    {
      "indent": 3,
      "text": "They would also like to thank their working group chairs, Matthew Bocci and Stephane Litkowski, and their AD, Martin Vigoureux, for their guidance and support.",
      "zh-CHS": "他们还要感谢工作组主席Matthew Bocci和Stephane Litkowski以及他们的广告Martin Vigoureux的指导和支持。"
    },
    {
      "indent": 3,
      "text": "Finally, they would like to thank the Directorate reviewers and the ADs for their thorough reviews and probing questions, the answers to which have substantially improved the quality of the document.",
      "zh-CHS": "最后，他们要感谢董事会审稿人和ADs，感谢他们进行了彻底的审查并提出了深入的问题，这些问题的答案大大提高了文件的质量。"
    },
    {
      "indent": 0,
      "text": "Contributors",
      "zh-CHS": "贡献者"
    },
    {
      "indent": 3,
      "text": "The following people have contributed substantially to this document and should be considered coauthors:",
      "zh-CHS": "以下人员对本文件做出了重大贡献，应被视为共同作者："
    },
    {
      "indent": 3,
      "text": "Antoni Przygienda Juniper Networks, Inc. 1194 N. Mathilda Ave. Sunnyvale, CA 94089 United States of America",
      "zh-CHS": "Antoni Przygienda Juniper Networks，Inc.美国加利福尼亚州桑尼维尔市马蒂尔达大道北1194号，邮编94089"
    },
    {
      "indent": 3,
      "text": "Email: prz@juniper.net",
      "raw": true,
      "zh-CHS": " "
    },
    {
      "indent": 3,
      "text": "Vinod Prabhu Nokia",
      "zh-CHS": "维诺德普拉布诺基亚"
    },
    {
      "indent": 3,
      "text": "Email: vinod.prabhu@nokia.com",
      "raw": true,
      "zh-CHS": " "
    },
    {
      "indent": 3,
      "text": "Wim Henderickx Nokia",
      "zh-CHS": "Wim Henderickx诺基亚"
    },
    {
      "indent": 3,
      "text": "Email: wim.henderickx@nokia.com",
      "raw": true,
      "zh-CHS": " "
    },
    {
      "indent": 3,
      "text": "Wen Lin Juniper Networks, Inc.",
      "zh-CHS": "文林Juniper网络公司。"
    },
    {
      "indent": 3,
      "text": "Email: wlin@juniper.net",
      "raw": true,
      "zh-CHS": " "
    },
    {
      "indent": 3,
      "text": "Patrice Brissette Cisco Systems",
      "zh-CHS": "帕特里斯·布里塞特思科系统公司"
    },
    {
      "indent": 3,
      "text": "Email: pbrisset@cisco.com",
      "raw": true,
      "zh-CHS": " "
    },
    {
      "indent": 3,
      "text": "Keyur Patel Arrcus, Inc.",
      "zh-CHS": "凯乌尔·帕特尔·阿卡斯公司。"
    },
    {
      "indent": 3,
      "text": "Email: keyur@arrcus.com",
      "raw": true,
      "zh-CHS": " "
    },
    {
      "indent": 3,
      "text": "Autumn Liu Ciena",
      "zh-CHS": "秋柳西娜"
    },
    {
      "indent": 3,
      "text": "Email: hliu@ciena.com",
      "raw": true,
      "zh-CHS": " "
    },
    {
      "indent": 0,
      "text": "Authors' Addresses",
      "zh-CHS": "作者地址"
    },
    {
      "indent": 3,
      "text": "Jorge Rabadan (editor) Nokia 777 E. Middlefield Road Mountain View, CA 94043 United States of America",
      "zh-CHS": "豪尔赫·拉巴丹（编辑）诺基亚777 E.米德尔菲尔德路山景城，加利福尼亚州94043"
    },
    {
      "indent": 3,
      "text": "Email: jorge.rabadan@nokia.com",
      "raw": true,
      "zh-CHS": " "
    },
    {
      "indent": 3,
      "text": "Satya Mohanty (editor) Cisco Systems, Inc. 225 West Tasman Drive San Jose, CA 95134 United States of America",
      "zh-CHS": "Satya Mohanty（编辑）思科系统公司，美国加利福尼亚州圣何塞西塔斯曼大道225号，邮编95134"
    },
    {
      "indent": 3,
      "text": "Email: satyamoh@cisco.com",
      "raw": true,
      "zh-CHS": " "
    },
    {
      "indent": 3,
      "text": "Ali Sajassi Cisco Systems, Inc. 225 West Tasman Drive San Jose, CA 95134 United States of America",
      "zh-CHS": "美国加利福尼亚州圣何塞市西塔斯曼大道225号Ali Sajassi Cisco Systems，Inc.95134"
    },
    {
      "indent": 3,
      "text": "Email: sajassi@cisco.com",
      "raw": true,
      "zh-CHS": " "
    },
    {
      "indent": 3,
      "text": "John Drake Juniper Networks, Inc. 1194 N. Mathilda Ave. Sunnyvale, CA 94089 United States of America",
      "zh-CHS": "John Drake Juniper Networks，Inc.美国加利福尼亚州桑尼维尔市马蒂尔达大道北1194号，邮编94089"
    },
    {
      "indent": 3,
      "text": "Email: jdrake@juniper.net",
      "raw": true,
      "zh-CHS": " "
    },
    {
      "indent": 3,
      "text": "Kiran Nagaraj Nokia 701 E. Middlefield Road Mountain View, CA 94043 United States of America",
      "zh-CHS": "Kiran Nagaraj诺基亚701 E.米德尔菲尔德路山景城，加利福尼亚州94043"
    },
    {
      "indent": 3,
      "text": "Email: kiran.nagaraj@nokia.com",
      "raw": true,
      "zh-CHS": " "
    },
    {
      "indent": 3,
      "text": "Senthil Sathappan Nokia 701 E. Middlefield Road Mountain View, CA 94043 United States of America",
      "zh-CHS": "Senthil Sathappan诺基亚701 E.米德尔菲尔德路山景城，加利福尼亚州94043"
    },
    {
      "indent": 3,
      "text": "Email: senthil.sathappan@nokia.com",
      "raw": true,
      "zh-CHS": " "
    }
  ]
}